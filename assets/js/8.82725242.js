(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{397:function(e,t,s){"use strict";s.r(t);var n=s(31),a=Object(n.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"integration-continue"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#integration-continue"}},[e._v("#")]),e._v(" Int√©gration continue")]),e._v(" "),s("h2",{attrs:{id:"pre-requis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pre-requis"}},[e._v("#")]),e._v(" Pr√©-requis")]),e._v(" "),s("ul",[s("li",[e._v("Git")]),e._v(" "),s("li",[e._v("GitLab / GitHub / Bitbucket / √©quivalent")]),e._v(" "),s("li",[e._v("Yaml ("),s("a",{attrs:{href:"https://www.codeproject.com/Articles/1214409/Learn-YAML-in-five-minutes",target:"_blank",rel:"noopener noreferrer"}},[e._v("apprendre le YAML en 5 minutes"),s("OutboundLink")],1),e._v(")")])]),e._v(" "),s("h2",{attrs:{id:"definitions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#definitions"}},[e._v("#")]),e._v(" D√©finitions")]),e._v(" "),s("p",[e._v("L'introduction en vid√©o :")]),e._v(" "),s("div",{staticStyle:{position:"relative","padding-bottom":"56.25%",height:"0"}},[s("iframe",{staticStyle:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},attrs:{src:"https://www.loom.com/embed/85edd5f003384961baa88d784ef2ca9c",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}})]),e._v(" "),s("h3",{attrs:{id:"devops"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#devops"}},[e._v("#")]),e._v(" DevOps")]),e._v(" "),s("p",[e._v("Le DevOps est une pratique technique, visant √† unifier le d√©veloppement (logiciel) et l'administration syst√®me (gestion des serveurs).")]),e._v(" "),s("p",[e._v("Dans les faits, on parle de DevOps √† la fois pour la pratique et comme m√©tier/sp√©cialisation. Dans les deux cas, il s'agit de mettre en place divers outils, permettant de s'assurer de la qualit√© du produit et du respect du cahier des charges au fur et √† mesure du d√©veloppement.")]),e._v(" "),s("p",[e._v("En pratique, cela implique :")]),e._v(" "),s("ul",[s("li",[e._v("des cycles de d√©veloppement courts")]),e._v(" "),s("li",[e._v("un travail d'√©quipe (relecture du code et mise en place de pratiques communes)")]),e._v(" "),s("li",[e._v("la mise en place, d√®s le d√©part, de tests, d'outils de v√©rification de la qualit√© du code ou de la performance, etc. et leur automatisation")]),e._v(" "),s("li",[e._v("la mise en place d'environnements de travail au plus pr√®s de l'environnement de production (et lancement des outils automatis√©s dans ce contexte)")]),e._v(" "),s("li",[e._v("des mises √† disposition (d√©ploiement) tr√®s r√©guli√®res, que ce soit pour des tests ou en production")]),e._v(" "),s("li",[e._v("la surveillance du fonctionnement et de la qualit√© de la production par des m√©triques d√©finies au plus t√¥t.")])]),e._v(" "),s("h3",{attrs:{id:"deploiement-continu"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deploiement-continu"}},[e._v("#")]),e._v(" D√©ploiement continu")]),e._v(" "),s("p",[e._v("L'id√©e du d√©ploiement continu est de livrer les nouvelles fonctionnalit√©s au client d√®s qu'elles sont disponibles. Pour cela, on d√©ploie les modifications de mani√®re "),s("strong",[e._v("automatique")]),e._v(" d√®s leur validation (en g√©n√©ral par le client sur un autre environnement) ou leur fusion dans la branche principale.")]),e._v(" "),s("p",[e._v("On cherche ainsi √† am√©liorer l'application en continu et cr√©er des cycles courts de d√©veloppement. Chaque d√©ploiement pouvant √™tre annul√© facilement (car peu de modification), on √©vite aussi l'une des grandes contraintes des cycles longs.")]),e._v(" "),s("h3",{attrs:{id:"integration-continue-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#integration-continue-2"}},[e._v("#")]),e._v(" Int√©gration continue")]),e._v(" "),s("p",[e._v("L'int√©gration continue a pour but de v√©rifier chaque modification du code source, pour √©viter les r√©gressions et autres bugs (autant que possible). Un outil d'int√©gration continue permet de lancer automatiquement diverses actions de v√©rification du projet (compilation, linters, test unitaires et fonctionnels, etc.) ou toute autre t√¢che automatisable (cf\nd√©ploiement continu üòâ ).")]),e._v(" "),s("p",[e._v("Pour utiliser des outils d'int√©gration continue, il faut que :")]),e._v(" "),s("ul",[s("li",[e._v("le code soit versionn√© (git, svn, etc.)")]),e._v(" "),s("li",[e._v("des outils de v√©rification automatiques existent dans le projet (compilation, tests, etc.)")])]),e._v(" "),s("p",[e._v("Si on souhaite mettre en place du d√©ploiement continu (avec ou sans int√©gration continue), il faut que :")]),e._v(" "),s("ul",[s("li",[e._v("le projet puisse √™tre mis sur un serveur / sa machine de destination")]),e._v(" "),s("li",[e._v("des outils de d√©ploiement aient √©t√© mis en place")])]),e._v(" "),s("h4",{attrs:{id:"outils-d-integration-continue"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#outils-d-integration-continue"}},[e._v("#")]),e._v(" Outils d'int√©gration continue")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.jenkins.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Jenkins"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://travis-ci.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("TravisCI"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"http://cruisecontrol.sourceforge.net/",target:"_blank",rel:"noopener noreferrer"}},[e._v("CruiseControl"),s("OutboundLink")],1)]),e._v(" "),s("li",[e._v("mais aussi "),s("a",{attrs:{href:"https://docs.github.com/en/actions",target:"_blank",rel:"noopener noreferrer"}},[e._v("GitHub actions"),s("OutboundLink")],1),e._v(", "),s("a",{attrs:{href:"https://bitbucket.org/product/fr/features/pipelines",target:"_blank",rel:"noopener noreferrer"}},[e._v("Bitbucket Pipelines"),s("OutboundLink")],1),e._v(" ou "),s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/",target:"_blank",rel:"noopener noreferrer"}},[e._v("GitLab CI"),s("OutboundLink")],1)])]),e._v(" "),s("p",[e._v("Nous allons nous concentrer sur les "),s("a",{attrs:{href:"https://docs.github.com/en/actions",target:"_blank",rel:"noopener noreferrer"}},[e._v("GitHub actions"),s("OutboundLink")],1),e._v(" et "),s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/",target:"_blank",rel:"noopener noreferrer"}},[e._v("GitLab CI"),s("OutboundLink")],1),e._v(", qui sont plut√¥t simples √† utiliser et plus rapides √† mettre en place (en plus d'avoir une logique similaire).")]),e._v(" "),s("h3",{attrs:{id:"docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[e._v("#")]),e._v(" Docker")]),e._v(" "),s("p",[e._v("Docker est un logiciel libre permettant de lancer des applications dans des conteneurs, ayant des t√¢ches sp√©cifiques (en g√©n√©ral, chaque conteneur permet de lancer 1 programme pr√©cis, avec ses d√©pendances directes).")]),e._v(" "),s("p",[e._v("Contrairement √† la virtualisation, qui reproduit toutes les caract√©ristiques d'une machine, la conteneurisation s'appuie sur certaines parties de la machine h√¥te (dont le syst√®me d'exploitation) pour fonctionner (ce qui am√©liore grandement la compatibilit√© et la flexibilit√©). Un autre int√©r√™t est de s√©parer compl√®tement l'ex√©cution des diff√©rents services n√©cessaires √† une application (BdD, serveur, etc.), les lan√ßant dans des processus s√©par√©s.")]),e._v(" "),s("p",[e._v("Pour plus d'informations sur le sujet, vous pouvez consulter "),s("RouterLink",{attrs:{to:"/docker/"}},[e._v("le cours sur Docker, sur ce site")]),e._v(".")],1),e._v(" "),s("h3",{attrs:{id:"d-autres-outils-utiles"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#d-autres-outils-utiles"}},[e._v("#")]),e._v(" D'autres outils utiles")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://gitlab.com/xavki/sommaire-xavki-tutos-fr",target:"_blank",rel:"noopener noreferrer"}},[e._v("Un grand ensemble de tuto DevOps par Xavki"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://phpstan.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Un outil d'analyse statique pour Php"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://www.atlassian.com/fr/git/tutorials/comparing-workflows/gitflow-workflow",target:"_blank",rel:"noopener noreferrer"}},[e._v("Git workflow"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/index.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Ansible"),s("OutboundLink")],1),e._v(" (automatisation de t√¢ches et gestion d'√©tats)")])]),e._v(" "),s("h2",{attrs:{id:"gitlab-et-github"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-et-github"}},[e._v("#")]),e._v(" "),s("a",{attrs:{href:"https://www.gitlab.com",target:"_blank",rel:"noopener noreferrer"}},[e._v("GitLab"),s("OutboundLink")],1),e._v(" et "),s("a",{attrs:{href:"https://www.github.com",target:"_blank",rel:"noopener noreferrer"}},[e._v("GitHub"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("Une pr√©sentation de GitLab et GitHub en vid√©o :")]),e._v(" "),s("div",{staticStyle:{position:"relative","padding-bottom":"56.25%",height:"0"}},[s("iframe",{staticStyle:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},attrs:{src:"https://www.loom.com/embed/294683a858734af694d4b2edcb68d4c5",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}})]),e._v(" "),s("p",[e._v("Bien que tout ce qui suit s'applique aussi bien √† Bitbucket, la syntaxe et les denominations changent d'un outil √† l'autre. Les concepts restent les m√™mes et il est plut√¥t ais√© d'adapter ce que vous verrez ici √† d'autres outils de CI/CD.")]),e._v(" "),s("p",[e._v("GitLab et GitHub sont des gestionnaires de repositories git en ligne. Ils peuvent servir, entre autre, de :")]),e._v(" "),s("ul",[s("li",[e._v("gestionnaire de tickets")]),e._v(" "),s("li",[e._v("d'outils de revue de code")]),e._v(" "),s("li",[e._v("plateforme de CI/CD")])]),e._v(" "),s("p",[e._v("Nous allons nous baser sur Git et ses m√©caniques, voici quelques resources pouvant √™tre utiles pour le ma√Ætriser :")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://about.gitlab.com/images/press/git-cheat-sheet.pdf",target:"_blank",rel:"noopener noreferrer"}},[e._v("Git Cheat Sheet"),s("OutboundLink")],1),e._v(" (ou "),s("a",{attrs:{href:"https://github.github.com/training-kit/downloads/fr/github-git-cheat-sheet.pdf",target:"_blank",rel:"noopener noreferrer"}},[e._v("en Fran√ßais"),s("OutboundLink")],1),e._v(")")]),e._v(" "),s("li",[s("a",{attrs:{href:"https://git-scm.com/docs",target:"_blank",rel:"noopener noreferrer"}},[e._v("la documentation officielle"),s("OutboundLink")],1)]),e._v(" "),s("li",[e._v("une "),s("a",{attrs:{href:"https://www.atlassian.com/fr/git/tutorials/learn-git-with-bitbucket-cloud",target:"_blank",rel:"noopener noreferrer"}},[e._v("documentation Bitbucket"),s("OutboundLink")],1),e._v(" assez compl√®te et en fran√ßais")])]),e._v(" "),s("h3",{attrs:{id:"revue-de-code"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#revue-de-code"}},[e._v("#")]),e._v(" Revue de code")]),e._v(" "),s("p",[e._v("L'un des grands int√©r√™ts de travailler avec Git (en plus d'avoir un code versionn√©) est de faciliter le travail collaboratif, gr√¢ce notamment aux revues de code.")]),e._v(" "),s("p",[e._v("Mais "),s("strong",[e._v("pourquoi relire le code d'un autre dev ?")])]),e._v(" "),s("ul",[s("li",[e._v("V√©rifier que la demande initiale est respect√©e")]),e._v(" "),s("li",[e._v("Que le code produit r√©pond aux "),s("strong",[e._v("bonnes pratiques communes")])]),e._v(" "),s("li",[e._v("Avoir un second (ou troisi√®me, quatri√®me, etc.) point de vue sur le travail effectu√© et trouver d'√©ventuels bugs avant qu'ils ne se d√©voilent au client.")])]),e._v(" "),s("p",[e._v("Cette revue de code se fait en g√©n√©ral dans les Merge/Pull Requests (MR ou PR) du projet.")]),e._v(" "),s("h2",{attrs:{id:"ci-cd-avec-gitlab"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ci-cd-avec-gitlab"}},[e._v("#")]),e._v(" CI / CD avec GitLab")]),e._v(" "),s("p",[e._v("La "),s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/introduction/index.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("documentation officielle de GitLab"),s("OutboundLink")],1),e._v(" √† laquelle je vais beaucoup me r√©f√©rer.")]),e._v(" "),s("p",[e._v("Pour se faire, notre principal outil va √™tre le fichier "),s("code",[e._v(".gitlab-ci.yml")]),e._v(". C'est dans ce fichier que nous allons d√©finir nos t√¢ches ("),s("code",[e._v("jobs")]),e._v(") et nos √©tapes ("),s("code",[e._v("stages")]),e._v(").")]),e._v(" "),s("ul",[s("li",[e._v("L'ensemble des √©tapes forment ce qu'on appelle un "),s("code",[e._v("Pipeline")]),e._v(".")]),e._v(" "),s("li",[e._v("Les √©tapes contiennent des t√¢ches. Ce sont des commandes (actions) que l'on va faire lancer √† notre serveur (GitLab).")]),e._v(" "),s("li",[e._v("Les t√¢ches sont ex√©cut√©es par des "),s("code",[e._v("runners")])])]),e._v(" "),s("h3",{attrs:{id:"un-exemple"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#un-exemple"}},[e._v("#")]),e._v(" Un exemple")]),e._v(" "),s("p",[e._v("Un exemple de Workflow que nous pouvons construire :")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://docs.gitlab.com/ee/ci/introduction/img/gitlab_workflow_example_11_9.png",alt:"Un Workflow GitLab : depuis une nouvelle branche, on lance les actions automatiques jusqu'au merge, qui d√©clenche d'autres actions automatiques"}})]),e._v(" "),s("p",[e._v("La version plus d√©taill√©e :")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://docs.gitlab.com/ee/ci/introduction/img/gitlab_workflow_example_extended_v12_3.png",alt:"Un Workflow GitLab : depuis une nouvelle branche, on lance les actions automatiques jusqu'au merge, qui d√©clenche d'autres actions automatiques"}})]),e._v(" "),s("p",[e._v("Que se passe-t-il dans ces images :")]),e._v(" "),s("ul",[s("li",[e._v("Un d√©veloppeur cr√©e une branche et cr√©e plusieurs changements (des commits)")]),e._v(" "),s("li",[e._v("D√®s que le serveur re√ßoit ses commits (push), un pipeline est lanc√©\n"),s("ul",[s("li",[e._v("ce pipeline contient un ensemble d'√©tapes (stages) qui doivent √™tre valid√©es pour passer √† la suivante")]),e._v(" "),s("li",[e._v("chaque √©tape d√©finit plusieurs t√¢ches √† ex√©cuter et, dans notre exemple, certaines t√¢ches cr√©ent une erreur")])])]),e._v(" "),s("li",[e._v("Le pipeline renvoie une erreur")]),e._v(" "),s("li",[e._v("Le d√©veloppeur cr√©e plusieurs commits pour corriger les diff√©rents probl√®mes et les push")]),e._v(" "),s("li",[e._v("Un nouveau pipeline est lanc√©")]),e._v(" "),s("li",[e._v("Cette fois, tout fonctionne. L'une des t√¢ches est le d√©ploiement d'une Review App, c‚Äôest-√†-dire le d√©ploiement d'un site permettant de tester la branche, dans des conditions r√©elles (tr√®s utile pour le reviewer de la Merge Request üòâ ).")]),e._v(" "),s("li",[e._v("Un(e) autre membre de l'√©quipe relit et teste le code du d√©veloppeur et approuve sa Merge Request")]),e._v(" "),s("li",[e._v("La Merge Request est fusionn√©e")]),e._v(" "),s("li",[e._v("Un nouveau pipeline est lanc√©\n"),s("ul",[s("li",[e._v("si le projet fait de la livraison continue ("),s("em",[e._v("Continuous Delivery")]),e._v("), une t√¢che peut √™tre lanc√©e (manuellement) pour mettre l'application en production")]),e._v(" "),s("li",[e._v("si le projet fait du d√©ploiement continue ("),s("em",[e._v("Continuous Deployment")]),e._v("), cette t√¢che est lanc√©e automatiquement")])])])]),e._v(" "),s("h3",{attrs:{id:"configuration-du-fichier-de-ci"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration-du-fichier-de-ci"}},[e._v("#")]),e._v(" Configuration du fichier de CI")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://blog.eleven-labs.com/fr/introduction-gitlab-ci/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Mon pense-b√™te favori"),s("OutboundLink")],1),e._v(", par Nicolas Gr√©vin de Eleven Labs")]),e._v(" "),s("p",[e._v("Son nom et son emplacement sont standard : "),s("code",[e._v(".gitlab-ci.yml")]),e._v(" √† la racine du projet Sur GitLab, vous pouvez modifier cela dans : "),s("code",[e._v("Settings (menu de gauche) > CI/CD > General pipelines > Custom CI config path")])]),e._v(" "),s("p",[e._v("Toutefois, je vous conseille de garder la configuration de base, c'est ce qui est attendu par beaucoup de d√©veloppeurs.")]),e._v(" "),s("p",[e._v("Un exemple de fichier "),s("code",[e._v(".gitlab-ci.yml")]),e._v(" (celui utilis√© par ce site) :")]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Pour r√©aliser ce fichier, je me suis bas√© sur le tuto d'Eleven Labs : ")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# https://blog.eleven-labs.com/fr/introduction-gitlab-ci/")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On d√©finit les diff√©rentes √©tapes (stages) √† faire tourner dans le pipeline")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("stages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# cette √©tape (stage) va compiler l'application, ")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# permettant de v√©rifier qu'il n'y ait pas d'erreur d√®s la compilation")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" build\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# D√©ploie l'application sur le serveur appropri√©, si n√©cessaire")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" deploy\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On d√©finit une t√¢che (job) qui pourra √™tre lanc√©e lors d'un stage")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("pages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Ce job sera ex√©cut√© lors du stage build")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" build\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On va lancer ce job dans un container Docker. ")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Ici, une image nodejs de chez Drakona, en version 14 (utilisant Alpine)")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" drakona/node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("14"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("alpine\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On met certains dossiers en cache, pour les conserver d'une ex√©cution √† l'autre")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Ici, on garde le dossier node_modules, ")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# afin de ne pas re-t√©l√©charger toutes les d√©pendances √† chaque fois")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" node_modules/\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Le script que va utiliser ce job. Ici, on profite de notre Makefile !")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" make update build\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("artifacts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" public\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Des tags pour d√©terminer quel runner va ex√©cuter la t√¢che.")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Ici, c'est une configuration personnalis√©e, pour notre GitLab.")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Nous avons cr√©√© nos propres runners")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Pour cette t√¢che, nous allons utiliser un runner utilisant Docker")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Dans notre cas, il y a 6 runners r√©pondant √† ce tag")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Et c'est le premier disponible qui l'ex√©cutera.")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" docker\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Un autre job, qui va d√©ployer notre application sur le serveur de prod")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("deploy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Avant d'ex√©cuter le script, on va faire un ensemble de commandes,")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# pour avoir une cl√© SSH valide et pr√™te √† l'emploi")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("before_script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On s'assure que openssh est install√©")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'command -v ssh-agent >/dev/null || ( apt-get update -y && apt-get install openssh-client -y )'")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On lance le client SSH")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" eval $(ssh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("agent "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("s)\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On va chercher la variable d'environnement DEPLOY_SK, d√©finie dans GitLab")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# et qui contient une cl√© priv√©e que l'on va utiliser pour le d√©ploiement")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(' echo "$DEPLOY_SK" '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("|")]),e._v(" tr "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("d '\\r' "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("|")]),e._v(" ssh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("add "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On s'assure d'avoir un dossier .ssh et qu'il ait des droits corrects")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" mkdir "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("p ~/.ssh\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" chmod 700 ~/.ssh\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Ce job se lance lors du stage deploy")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" deploy\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Le script √† ex√©cuter")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" make deploy\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Ce d√©ploiement n'a lieu que si l'on fait une action sur main ")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# (commit, push, merge, etc.)")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("only")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" main\n")])])]),s("h3",{attrs:{id:"pipelines"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pipelines"}},[e._v("#")]),e._v(" Pipelines")]),e._v(" "),s("p",[e._v("Par d√©faut, un pipeline est lanc√© d√®s qu'un nouveau commit est pouss√© (push) sur GitLab (si vous en poussez plusieurs dans la m√™me branche, un seul pipeline sera lanc√©, sur le dernier commit).")]),e._v(" "),s("p",[e._v("Vous pouvez voir les pipelines directement dans la partie "),s("code",[e._v("CI/CD")]),e._v(" de votre repository, mais ils sont plus pratiques √† d'autres emplacements de l'interface.")]),e._v(" "),s("p",[e._v("Sur la partie "),s("code",[e._v("Project Overview")]),e._v(" :")]),e._v(" "),s("p",[s("img",{attrs:{src:"/assets/img/ci/ci-pipeline-overview.png",alt:""}})]),e._v(" "),s("p",[e._v("Sur la liste des Merge Requests :")]),e._v(" "),s("p",[s("img",{attrs:{src:"/assets/img/ci/ci-pipeline-mr.png",alt:""}})]),e._v(" "),s("p",[e._v("Ou sur une "),s("code",[e._v("Merge Request")]),e._v(" :")]),e._v(" "),s("p",[s("img",{attrs:{src:"/assets/img/ci/ci-pipeline-mr2.png",alt:""}})]),e._v(" "),s("p",[e._v("C'est sur ce dernier affichage que vous pouvez avoir l'adresse pour une "),s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/review_apps/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Review App"),s("OutboundLink")],1),e._v(", qui est le lien entre une branche de votre repository et un "),s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/environments/index.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("environnement"),s("OutboundLink")],1),e._v(" (un serveur permettant de tester cette branche, en somme).")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/review_apps/",target:"_blank",rel:"noopener noreferrer"}},[e._v("La documentation officielle sur les Review App"),s("OutboundLink")],1),e._v(" et "),s("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/environments/index.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("celle sur les environnements"),s("OutboundLink")],1)]),e._v(" "),s("h3",{attrs:{id:"les-runners"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#les-runners"}},[e._v("#")]),e._v(" Les runners")]),e._v(" "),s("p",[e._v("Pour lancer les t√¢ches, GitLab utilise des programmes ind√©pendants, les "),s("code",[e._v("runners")]),e._v(". GitLab fourni de nombreux runners et vous permet √©ventuellement d'en cr√©er vous-m√™me, en quelques lignes de commande.")]),e._v(" "),s("p",[e._v("Il y a 4 grands types de runners, disponibles par d√©faut :")]),e._v(" "),s("ul",[s("li",[e._v("shell (la ligne de commande du serveur)")]),e._v(" "),s("li",[e._v("ssh (on ex√©cute nos commandes "),s("em",[e._v("via")]),e._v(" SSH sur un autre serveur)")]),e._v(" "),s("li",[e._v("docker (on ex√©cute nos commandes dans un container Docker)")]),e._v(" "),s("li",[e._v("Kubernetes (on ex√©cute nos commandes dans un environnement Kubernetes)")])]),e._v(" "),s("p",[e._v("‚ö†Ô∏è Conseil gitlab.com : toujours utiliser docker (avec le tag "),s("code",[e._v("gitlab-org-docker")]),e._v(" et une image Docker sur vos t√¢ches, √† moins que vous ne codiez en Ruby üòâ ).")]),e._v(" "),s("h3",{attrs:{id:"taches-jobs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#taches-jobs"}},[e._v("#")]),e._v(" T√¢ches / jobs")]),e._v(" "),s("p",[e._v("Une t√¢che doit toujours lancer un ou des scripts (commandes √† ex√©cuter), tout le reste est optionnel. De nombreuses options permettent de personnaliser les conditions de lancement de la t√¢che, les pr√©-requis, etc. Les diff√©rentes options des t√¢ches :")]),e._v(" "),s("ul",[s("li",[e._v("script : d√©claration obligatoire, contenant les commandes √† ex√©cuter")])]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("pages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" make update\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" make build\n")])])]),s("ul",[s("li",[e._v("before_script ou after_script : permet d'ex√©cuter une ou des commandes avant ou apr√®s le script de notre t√¢che. Vous pouvez √©galement les d√©finir pour toutes vos t√¢ches, en les pr√©cisant √† la racine")])]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("before_script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(' echo "avant tous les scripts'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(' sauf si un before script est d√©fini dans une t√¢che"\n\n'),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("pages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("before_script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(' echo "avant script"\n  '),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" make update\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" make build\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("after_script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(' echo "apr√®s script"\n')])])]),s("ul",[s("li",[e._v("image : nom d'une image Docker √† utiliser pour ex√©cuter la t√¢che. Peut √™tre √©crit √† la racine pour l'ex√©cution de toutes les t√¢ches.")])]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# toutes les t√¢ches seront ex√©cut√©es dans des conteneurs nodejs, en version 12")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("12")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("pages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Cette t√¢che sera ex√©cut√©e dans un conteneur php-fpm")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" php"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("fpm\n")])])]),s("ul",[s("li",[e._v("services : permet d'ajouter des conteneurs Docker pour aider dans les t√¢ches (associer une BdD par exemple)")])]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("pages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" php"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("fpm\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On appelle le service postgres pour acc√©der √† une BdD")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" postgres\n")])])]),s("ul",[s("li",[e._v("stages : permet de regrouper les t√¢ches dans des √©tapes :")])]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# D√©claration des diff√©rentes √©tapes disponibles")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("stages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" build\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" deploy\n  \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("pages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# la t√¢che pages est dans l'√©tape build")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" build\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#...")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("deploy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# la t√¢che deploy est dans l'√©tape deploy")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" deploy\n")])])]),s("ul",[s("li",[e._v("only et except : d√©finition de contraintes d'ex√©cution d'une t√¢che. "),s("code",[e._v("only")]),e._v(" peut, par exemple, pr√©ciser qu'on ne lancera la t√¢che que lors d'un "),s("em",[e._v("push sur master")]),e._v(", "),s("code",[e._v("except")]),e._v(" que si le push √† lieu sur "),s("em",[e._v("une branche autre que master")])])]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("deploy-master")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" make deploy\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("only")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" master "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Le job sera effectu√© uniquement lors d‚Äôun √©v√©nement sur la branche master")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("test-not-master")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" make test\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("except")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" master "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Le job sera effectu√© sur toutes les branches lors d‚Äôun √©v√©nement sauf sur la branche master")]),e._v("\n\n")])])]),s("ul",[s("li",[e._v("cache : Mettre des fichiers et des r√©pertoires en cache et qui seront disponible dans le pipeline (ils sont d√©truits apr√®s l'ex√©cution du pipeline, que ce soit un succ√®s ou non)")])]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("push-cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" make cache\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Chemin des fichiers et dossiers √† conserver")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" cache "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# r√©pertoire mis en cache")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("policy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" push "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On pr√©cise qu'on ajoute au cache")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("pull-cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" make somethingWithCache\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" build\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("policy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" pull "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# r√©cup√©ration du dossier build dans le cache")]),e._v("\n")])])]),s("p",[e._v("Et beaucoup d'autres, que je vous invite "),s("a",{attrs:{href:"https://blog.eleven-labs.com/fr/introduction-gitlab-ci/",target:"_blank",rel:"noopener noreferrer"}},[e._v("√† d√©couvrir ici"),s("OutboundLink")],1),e._v(" üòâ")]),e._v(" "),s("h2",{attrs:{id:"ci-cd-avec-github"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ci-cd-avec-github"}},[e._v("#")]),e._v(" CI / CD avec GitHub")]),e._v(" "),s("p",[e._v("L'"),s("a",{attrs:{href:"https://docs.github.com/en/actions/learn-github-actions",target:"_blank",rel:"noopener noreferrer"}},[e._v("introduction officielle aux GitHub Actions"),s("OutboundLink")],1),e._v(", et la vid√©o qui va avec :")]),e._v(" "),s("iframe",{attrs:{width:"560",height:"315",src:"https://www.youtube-nocookie.com/embed/cP0I9w2coGU",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""}}),e._v(" "),s("p",[e._v("‚ö†Ô∏è L'utilisation de GitHub Actions est limit√©e et d√©pend de votre abonnement √† GitHub (pour les projets professionnels d'envergure, un abonnement peut √™tre n√©cessaire, mais pas pour les projets personnels, normalement). Voir "),s("a",{attrs:{href:"https://docs.github.com/en/actions/reference/usage-limits-billing-and-administration#about-billing-for-github-actions",target:"_blank",rel:"noopener noreferrer"}},[e._v("la documentation officielle sur les limitations de GitHub Actions selon votre abonnement"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("h3",{attrs:{id:"un-workflow-basique"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#un-workflow-basique"}},[e._v("#")]),e._v(" Un Workflow basique")]),e._v(" "),s("p",[e._v("Un premier parcours en vid√©o de la doc pour expliquer les diff√©rents termes et le fonctionnement global de GitHub Actions :")]),e._v(" "),s("div",{staticStyle:{position:"relative","padding-bottom":"56.25%",height:"0"}},[s("iframe",{staticStyle:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},attrs:{src:"https://www.loom.com/embed/ef665b2420ad4446bb0955772748497a",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}})]),e._v(" "),s("p",[e._v("Avec GitHub, on ne parle plus de Pipelines, mais d'Actions. Tout comme avec GitLab, GitHub Actions permet d'ex√©cuter un ensemble de t√¢ches quand un √©v√©nement se produit sur le repository (distant). Le lexique est toutefois assez diff√©rent et il vaut mieux √©viter de m√©langer.")]),e._v(" "),s("ul",[s("li",[e._v("Un "),s("strong",[e._v("Workflow")]),e._v(" est une proc√©dure automatique, d√©crivant les diff√©rents Jobs qui vont √™tre lanc√©s quand un Event se produit,")]),e._v(" "),s("li",[e._v("un "),s("strong",[e._v("Event")]),e._v(" (push sur le repository, par exemple) on d√©clenche un ou plusieurs Jobs,")]),e._v(" "),s("li",[e._v("un "),s("strong",[e._v("Job")]),e._v(" contient des Steps,")]),e._v(" "),s("li",[e._v("une "),s("strong",[e._v("Step")]),e._v(" contient des actions,")]),e._v(" "),s("li",[e._v("une "),s("strong",[e._v("Action")]),e._v(" est un script (une commande) √† ex√©cuter.")])]),e._v(" "),s("p",[e._v("Les Jobs sont ex√©cut√©s par des "),s("strong",[e._v("runners")]),e._v(" (et peuvent √™tre diff√©rents pour chaque Job). Un "),s("strong",[e._v("runner")]),e._v(" lance les diff√©rentes actions sur une machine virtuelle (Ubuntu Linux, Microsoft Windows ou macOS). Il est √©galement possible d'utiliser Docker pour lancer nos actions (et nous n'utiliserons que des images officielles).")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://docs.github.com/assets/images/help/images/overview-actions-design.png",alt:"Un r√©sum√© des composants des Actions GitHub"}})]),e._v(" "),s("p",[e._v("Pour mettre en place des Workflows, il faut cr√©er un ensemble de fichiers "),s("code",[e._v(".yml")]),e._v(" dans le dossier "),s("code",[e._v(".github/workflows/")]),e._v(" du projet (en local, donc üòâ ). Ces fichiers peuvent √™tre nomm√© assez librement, mais leur nom doit √™tre toujours en minuscule, et on remplace les espaces par des tirets "),s("code",[e._v("-")]),e._v(".")]),e._v(" "),s("p",[e._v("La documentation propose de cr√©er le fichier "),s("code",[e._v(".github/workflows/learn-github-actions.yml")]),e._v(", contenant le code suivant (voir les commentaires pour le d√©tail). Cette commande cr√©e et pr√©pare un environnement nodejs et ex√©cute la commande "),s("code",[e._v("bats -v")])]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On donne un nom √† notre Workflow (optionnel). C'est ce nom qui apparaitra sur GitHub")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" learn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("actions\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On donne une liste d'√©v√©nements pour le d√©clencher")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Ici, d√®s qu'on push sur le repo distant")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("push"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On liste les Jobs √† effectuer")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("jobs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On a un seul job : check-bats-version qui va pr√©parer un projet nodejs ")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# et ex√©cuter une commande")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("check-bats-version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Ce job est ex√©cut√© dans une machine virtuelle Ubuntu")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Dans sa derni√®re version.")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Pour l'ex√©cuter dans une version pr√©cise (disons 19.04), il aurait fallu √©crire")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# runs-on: ubuntu-19.04")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("runs-on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("latest\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On d√©finit les steps (la liste des actions) √† ex√©cuter")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("steps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On appelle une action d√©j√† d√©finie par la communaut√© (noter le mot-cl√© uses)")]),e._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Ici, c'est une action qui va r√©cup√©rer le code (via git clone, a priori) et nous mettre sur la bonne branche")]),e._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" actions/checkout@v2\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Une action pour pr√©parer un environnement nodejs")]),e._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" actions/setup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("node@v2\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Avec un param√®tre sp√©cifique : on veut la version 14 de nodejs")]),e._v("\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n                  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("node-version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'14'")]),e._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On lance une commande (run) pour installer la librairie bats")]),e._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" npm install "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("g bats\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On lance la commande ")]),e._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" bats "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("v\n")])])]),s("p",[e._v("Il est int√©ressant de noter, dans l'exemple ce-dessus, l'usage des mots-cl√©s "),s("code",[e._v("uses")]),e._v(" et "),s("code",[e._v("run")]),e._v(" :")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://docs.github.com/en/actions/learn-github-actions/finding-and-customizing-actions",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("uses")]),e._v(" va utiliser un autre fichier, d√©finit par la communaut√©"),s("OutboundLink")],1),e._v(" (disponible dans les actions de "),s("em",[e._v("tous")]),e._v(" les projets) ou par vous-m√™mes (voir plus bas), pour ex√©cuter une ou plusieurs commandes (avec d'√©ventuels param√®tres)")]),e._v(" "),s("li",[s("code",[e._v("run")]),e._v(" va ex√©cuter une commande directement")])]),e._v(" "),s("p",[e._v("Sachez qu'il est √©galement possible d'√©crire ses propres actions. N'√©tant pas expert dans leur √©criture, je vous renvoie √† "),s("a",{attrs:{href:"https://docs.github.com/en/actions/creating-actions",target:"_blank",rel:"noopener noreferrer"}},[e._v("la documentation officielle pour la cr√©ation d'actions"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("Exemple, en vid√©o, de mise en place d'un premier Workflow sur un projet Symfony :")]),e._v(" "),s("div",{staticStyle:{position:"relative","padding-bottom":"56.25%",height:"0"}},[s("iframe",{staticStyle:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},attrs:{src:"https://www.loom.com/embed/7f140c95606e44d1b68c35f7aaceddf2",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}})]),e._v(" "),s("h3",{attrs:{id:"utiliser-des-conteneurs-docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#utiliser-des-conteneurs-docker"}},[e._v("#")]),e._v(" Utiliser des conteneurs Docker")]),e._v(" "),s("p",[e._v("Il est possible de d√©finir des conteneurs pour ex√©cuter utiliser des services suppl√©mentaires dans les actions ou directement pour ex√©cuter les actions elles-m√™mes. Les images √† utiliser et leurs configurations sont d√©finies au niveau du Job.\nLe but est ici d'ajouter un ensemble de programmes suppl√©mentaires, non pr√©sent par d√©faut dans la machine virtuelle Ubuntu, pour ex√©cuter certaines t√¢ches")]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("jobs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("container-job")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On conserve une machine virtuelle de base")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("runs-on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("latest\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Optionnel : on utilise un conteneur cr√©√© √† partir d'une image php officielle, ")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# en version 7.4.9. ")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Les actions du Job vont √™tre ex√©cut√©es dans ce conteneur")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("container")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" php"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("7.4.9\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On fait appel √† un ou des services suppl√©mentaires, ")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# qui vont √™tre lanc√©s dans des conteneurs")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On donne un nom √† notre service, qu'on utilise dans notre .env ")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# (c'est l'adresse de la BdD)")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("db")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On va utiliser l'image mysql (image officielle) en version 5.7")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5.7")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On passe des variables d'environnement, pour configurer notre conteneur")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" pass\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("MYSQL_DATABASE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" test\n\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("steps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# ... On ex√©cute plusieurs √©tapes n√©cessaires")]),e._v("\n      \n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On ex√©cute une action pour, par exemple, mettre √† jour la BdD")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Attention, notre fichier .env doit avec les bonnes valeurs")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Utilisateur : root")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Mot de passe : pass")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Adresse/IP du serveur : db")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Nom de la base : test")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# ")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# /!\\ Mettre √† jour ces √©l√©ments (dans le CI ou le .env) pour adapter √† votre cas !")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" Create DB\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" php bin/console doctrine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("migrations"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("migrate "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("n\n")])])]),s("p",[e._v("‚ö†Ô∏è Vous pouvez √©galement "),s("a",{attrs:{href:"https://docs.github.com/en/actions/creating-actions/dockerfile-support-for-github-actions",target:"_blank",rel:"noopener noreferrer"}},[e._v("cr√©er vos propres images Docker, mais il faut faire attention √† plusieurs points"),s("OutboundLink")],1),e._v(" importants !")]),e._v(" "),s("h3",{attrs:{id:"partager-des-fichiers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#partager-des-fichiers"}},[e._v("#")]),e._v(" Partager des fichiers")]),e._v(" "),s("p",[e._v("Il est possible, au fur et √† mesure de l'ex√©cution de votre Workflow, qu'il faille partager des fichiers, soit entre les jobs, soit en tant que r√©sultat (cr√©ation d'un fichier "),s("code",[e._v(".jar")]),e._v(" par exemple). Il est alors possible de "),s("a",{attrs:{href:"https://docs.github.com/en/actions/guides/storing-workflow-data-as-artifacts",target:"_blank",rel:"noopener noreferrer"}},[e._v("cr√©er des "),s("strong",[e._v("artifacts")]),s("OutboundLink")],1),e._v(" (nom donn√© aux fichiers cr√©√©s pendant le Workflow), associ√©s √† une ex√©cution de votre Workflow et partag√© entre plusieurs jobs (voir plusieurs ex√©cutions de votre Workflow !).")]),e._v(" "),s("p",[e._v("Pour sauvegarder, on utilise "),s("code",[e._v("actions/upload-artifact")]),e._v(" (dans sa version 2, dans l'exemple ci-dessous), qui permet de stocker un fichier sur GitHub")]),e._v(" "),s("p",[e._v("Pour r√©cup√©rer cette sauvegarde, on utilise "),s("code",[e._v("actions/download-artifact")]),e._v(" (dans sa version 2, dans l'exemple ci-dessous), qui permet de r√©cup√©rer des fichiers stock√©s sur GitHub")]),e._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("jobs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("example-job-with-save")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" Save output\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("steps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On lance une commande, qui sauvegarde son r√©sultat dans un fichier")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("shell")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" bash\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[e._v("\n          expr 1 + 1 > output.log")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On savegarde ce fichier sur GitHub, en tant qu'artifact")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" Upload output file\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" actions/upload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("artifact@v2\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n          "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On donne un nom √† notre artifact")]),e._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" output"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("file\n          "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Et un ensemble de fichiers qu'il contient (utiliser Glob ici)")]),e._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" output.log\n          \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("example-job-with-download")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("steps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On va r√©cup√©rer un artifact, pour peut √™tre s'en servir plus tard")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" Download a single artifact\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("needs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" example"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("job"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("with"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("save\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" actions/download"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("artifact@v2\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n          "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On r√©cup√®re les fichiers par le nom de l'artifact")]),e._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" output"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("file\n")])])]),s("p",[e._v("‚ö†Ô∏è Noter "),s("a",{attrs:{href:"https://docs.github.com/en/actions/learn-github-actions/managing-complex-workflows#creating-dependent-jobs",target:"_blank",rel:"noopener noreferrer"}},[e._v("l'utilisation du mot-cl√© "),s("code",[e._v("needs")]),s("OutboundLink")],1),e._v(" pour pr√©ciser que le deuxi√®me job a "),s("em",[e._v("besoin")]),e._v(" que le premier ait termin√© son travail. Ce mot-cl√© est tr√®s utile, du moment que vous avez plusieurs jobs, surtout s'ils d√©pendent les uns des autres.")]),e._v(" "),s("h3",{attrs:{id:"aller-plus-loin"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#aller-plus-loin"}},[e._v("#")]),e._v(" Aller plus loin")]),e._v(" "),s("p",[e._v("Nous avons ici effleur√© la surface de tout ce qu'il est possible de faire avec les GitHub Actions et je vous invite √† "),s("a",{attrs:{href:"https://docs.github.com/en/actions",target:"_blank",rel:"noopener noreferrer"}},[e._v("consulter la documentation officielle pour vous faire une id√©e de toutes les possibilit√©s"),s("OutboundLink")],1),e._v(" qu'offre cet outil !")]),e._v(" "),s("h2",{attrs:{id:"exercice-ci-de-notre-projet-symfony"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#exercice-ci-de-notre-projet-symfony"}},[e._v("#")]),e._v(" Exercice - CI de notre projet Symfony")]),e._v(" "),s("p",[e._v("Pour notre application Symfony, nous allons cr√©er un Workflow / pipeline pour installer et tester le projet. Nous ajouterons ensuite des outils suppl√©mentaires, que nous ajouterons √† notre int√©gration continue.")]),e._v(" "),s("h3",{attrs:{id:"les-elements-necessaires-a-notre-ci"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#les-elements-necessaires-a-notre-ci"}},[e._v("#")]),e._v(" Les √©l√©ments n√©cessaires √† notre CI")]),e._v(" "),s("ul",[s("li",[e._v("R√©cup√©rer le code (automatique avec GitLab, requiert une Action avec GitHub)")]),e._v(" "),s("li",[e._v("Installer les d√©pendances du projet")]),e._v(" "),s("li",[e._v("Cr√©er et initialiser la BdD (migrations + fixtures)")])]),e._v(" "),s("p",[e._v("Si vous utilisez "),s("strong",[e._v("GitLab")]),e._v(" :")]),e._v(" "),s("ul",[s("li",[e._v("D√©finissez les diff√©rentes √©tapes/stages et les fichiers qu'elles doivent partager")]),e._v(" "),s("li",[e._v("d√©finissez et impl√©mentez les t√¢ches/jobs demand√©es")])]),e._v(" "),s("p",[e._v("Si vous utiliser "),s("strong",[e._v("GitHub")]),e._v(" :")]),e._v(" "),s("ul",[s("li",[e._v("D√©finissez les diff√©rents jobs")]),e._v(" "),s("li",[e._v("D√©finissez les √©tapes et les actions √† effectuer")]),e._v(" "),s("li",[e._v("Appelez les actions pr√©-d√©finies ou cr√©ez-en si n√©cessaire")])]),e._v(" "),s("h3",{attrs:{id:"des-outils-a-integrer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#des-outils-a-integrer"}},[e._v("#")]),e._v(" Des outils √† int√©grer")]),e._v(" "),s("p",[e._v("Une fois que vous disposez d'une int√©gration continue qui fonctionne, vous √™tes pr√™ts √† rendre votre code plus beau et d'ajouter des outils de v√©rification suppl√©mentaire.")]),e._v(" "),s("p",[e._v("Je vous invite √† jeter un oeil √† "),s("a",{attrs:{href:"https://dev.to/duboiss/symfony-ce-que-j-aurai-aime-savoir-plus-tot-eke",target:"_blank",rel:"noopener noreferrer"}},[e._v("cet article regroupant quelques astuces pouvant √™tre utiles avec Symfony"),s("OutboundLink")],1)]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/FriendsOfPHP/PHP-CS-Fixer",target:"_blank",rel:"noopener noreferrer"}},[e._v("Php CS Fixer"),s("OutboundLink")],1),e._v(" : outil de v√©rification de la "),s("strong",[e._v("forme")]),e._v(" du code (attention, on utilise les options "),s("code",[e._v("--dry-run --diff")]),e._v(" pour seulement v√©rifier le code, pas le mettre √† jour)")]),e._v(" "),s("li",[e._v("Les linters de Symfony, pour v√©rifier nos fichiers de configuration et nos vues (mais aussi "),s("a",{attrs:{href:"https://symfony.com/doc/current/translation/lint.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("nos fichiers de traduction"),s("OutboundLink")],1),e._v(")")]),e._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/phpstan/phpstan",target:"_blank",rel:"noopener noreferrer"}},[e._v("PhpStan"),s("OutboundLink")],1),e._v(" et en particulier "),s("a",{attrs:{href:"https://github.com/phpstan/phpstan-symfony",target:"_blank",rel:"noopener noreferrer"}},[e._v("PhpStan Symfony"),s("OutboundLink")],1),e._v(" : outil d'analyse statique, pour d√©tecter les incoh√©rences du code et trouver des probl√®mes avant qu'ils ne se produisent. Un conseil : pour corriger les erreurs, commencer au niveau 1 et augmenter petit √† petit, jusqu'au niveau 5. Au dela du niveau 5, les erreurs sont bien plus complexes et p√©nibles √† corriger, et vont bien plus loin de ce que vous avez vu de PHP ici.")])]),e._v(" "),s("p",[e._v("Quelques autres outils, pour les courageux üòâ :")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://grafikart.fr/tutoriels/makefile-953",target:"_blank",rel:"noopener noreferrer"}},[e._v("Makefile"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://symfony.com/doc/current/testing.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("PhpUnit"),s("OutboundLink")],1),e._v(" ou Selenium pour des tests unitaires et/ou fonctionnels (si vous en avez, sinon c'est l'occasion de tester üòâ )")]),e._v(" "),s("li",[e._v("Si votre projet utilise npm :\n"),s("ul",[s("li",[e._v("lancer l'installation des paquets")]),e._v(" "),s("li",[e._v("utiliser les commandes n√©cessaires au fonctionnement du projet (compilation des fichiers Sass, appel √† Webpack, etc.)")])])])]),e._v(" "),s("h2",{attrs:{id:"exercice-ci-avec-gitlab"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#exercice-ci-avec-gitlab"}},[e._v("#")]),e._v(" Exercice - CI avec GitLab")]),e._v(" "),s("h3",{attrs:{id:"utilisation-des-bases"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#utilisation-des-bases"}},[e._v("#")]),e._v(" Utilisation des bases")]),e._v(" "),s("p",[e._v("Dans un premier temps, nous allons cr√©er une int√©gration continue fictive, avec des echos comme scripts.")]),e._v(" "),s("p",[e._v("Dans une nouvelle branche Git, construire un pipeline respectant les consignes suivantes (les scripts sont indiqu√©s entre parenth√®ses) :")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("des t√¢ches")]),e._v(" "),s("ul",[s("li",[e._v("composer ("),s("code",[e._v("echo 'composer install'")]),e._v(")")]),e._v(" "),s("li",[e._v("database ("),s("code",[e._v('echo "cr√©ation d\'une BdD et ex√©cution des migrations et fixtures"')]),e._v(")")]),e._v(" "),s("li",[e._v("tests unitaires ("),s("code",[e._v("echo 'tests unitaires'")]),e._v(")")]),e._v(" "),s("li",[e._v("tests fonctionnels ("),s("code",[e._v("echo 'tests fonctionnels'")]),e._v(")")]),e._v(" "),s("li",[e._v("d√©ploiement prod ("),s("code",[e._v("echo 'd√©ploiement prod'")]),e._v("), uniquement sur la branche main / master (votre branche principale) et √† d√©clencher manuellement (ne doit pas √™tre lanc√©e automatiquement)")]),e._v(" "),s("li",[e._v("d√©ploiement d√©mo ("),s("code",[e._v("echo 'd√©ploiement d√©mo'")]),e._v("), uniquement sur la branche principale")]),e._v(" "),s("li",[e._v("d√©ploiement App Review ("),s("code",[e._v("echo 'd√©ploiement app review'")]),e._v("), sur les branches autres que votre branche principale")])])]),e._v(" "),s("li",[s("p",[e._v("des √©tapes :")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("build")]),e._v(" qui contiendra les t√¢ches "),s("code",[e._v("composer")]),e._v(" et "),s("code",[e._v("database")])]),e._v(" "),s("li",[s("code",[e._v("test")]),e._v(" qui contiendra les t√¢ches de tests unitaires et fonctionnels")]),e._v(" "),s("li",[s("code",[e._v("deploy")]),e._v(" qui contiendra les t√¢ches de d√©ploiement (prod, d√©mo et App Review)")])])])]),e._v(" "),s("p",[e._v("Pour tester votre pipeline, faites un push de cette branche üòâ .")]),e._v(" "),s("p",[e._v("Question suppl√©mentaire, n√©cessaire pour la suite : comment faire en sorte de ne pas avoir √† faire un "),s("code",[e._v("composer install")]),e._v(" et de mettre en place la BdD pour chaque t√¢che ?")]),e._v(" "),s("h3",{attrs:{id:"ajout-de-docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ajout-de-docker"}},[e._v("#")]),e._v(" Ajout de Docker")]),e._v(" "),s("p",[e._v("Maintenant, nous allons mettre en place des scripts r√©els. Pour cela, nous allons √©galement utiliser 2 images Docker :")]),e._v(" "),s("ul",[s("li",[s("p",[s("code",[e._v("drakona/php:7.4-symfony")]),e._v(" en tant qu'image pour toutes nos t√¢ches")])]),e._v(" "),s("li",[s("p",[s("code",[e._v("mysql:5.7")]),e._v(" en tant que service, pour obtenir une BdD")])]),e._v(" "),s("li",[s("p",[e._v("Comment configurer MySQL ? (voir documentation de l'image mysql sur DockerHub)")])]),e._v(" "),s("li",[s("p",[e._v("Comment avoir la bonne configuration dans le fichier "),s("code",[e._v(".env")]),e._v(" pendant le pipeline ?")])]),e._v(" "),s("li",[s("p",[e._v("Ajouter les scripts r√©els :")]),e._v(" "),s("ul",[s("li",[e._v("la t√¢che "),s("code",[e._v("composer")]),e._v(" doit lancer un "),s("code",[e._v("composer install")])]),e._v(" "),s("li",[e._v("la t√¢che "),s("code",[e._v("database")]),e._v(" doit lancer les migrations et les fixtures")])])])]),e._v(" "),s("p",[e._v("Pour le moment, les autres t√¢ches vont continuer √† faire des "),s("code",[e._v("echo")])])])}),[],!1,null,null,null);t.default=a.exports}}]);