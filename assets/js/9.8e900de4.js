(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{393:function(e,t,s){"use strict";s.r(t);var r=s(31),n=Object(r.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"deploiement"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deploiement"}},[e._v("#")]),e._v(" D√©ploiement")]),e._v(" "),s("p",[e._v("Pour apprendre √† installer, vous pouvez retrouver "),s("a",{attrs:{href:"https://e-vinrude.drakolab.fr/cookbooks/firstTimeDeploy.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("une documentation sur le d√©ploiement avec Ansible"),s("OutboundLink")],1),e._v(" √©crite pour mes coll√®gues.")]),e._v(" "),s("h2",{attrs:{id:"deploiement-par-ftp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deploiement-par-ftp"}},[e._v("#")]),e._v(" D√©ploiement par FTP")]),e._v(" "),s("p",[e._v("En vid√©o :")]),e._v(" "),s("div",{staticStyle:{position:"relative","padding-bottom":"56.25%",height:"0"}},[s("iframe",{staticStyle:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},attrs:{src:"https://www.loom.com/embed/c66268b37c624ca6a801362cb87b9bd0",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}})]),e._v(" "),s("p",[e._v("Le FTP est un protocole de transfert de fichiers, permettant de se connecter √† un serveur pour mettre en ligne des fichiers ou en r√©cup√©rer depuis un serveur. Il peut s'utiliser en ligne de commande, ou en utilisant des interfaces graphiques, comme "),s("a",{attrs:{href:"https://filezilla-project.org/download.php?show_all=1",target:"_blank",rel:"noopener noreferrer"}},[e._v("FileZilla"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("p",[e._v("Il est tr√®s utile pour les sites simples (HTML, JS, CSS), ne n√©cessitant pas de lancer des commandes sur le serveur ou si le serveur n'offre pas d'acc√®s SSH.")]),e._v(" "),s("p",[e._v("Pour d√©ployer un site en FTP, nous avons besoin :")]),e._v(" "),s("ul",[s("li",[e._v("de l'adresse du site (IP ou nom de domaine)")]),e._v(" "),s("li",[e._v("d'un port √† utiliser")]),e._v(" "),s("li",[e._v("d'un identifiant et d'un mot de passe "),s("strong",[e._v("ou")]),e._v(" d'une cl√© SSH valide (ajout√©e au serveur)")]),e._v(" "),s("li",[e._v("de "),s("a",{attrs:{href:"https://filezilla-project.org/download.php?show_all=1",target:"_blank",rel:"noopener noreferrer"}},[e._v("FileZilla"),s("OutboundLink")],1),e._v(" ou d'un outil de FTP √©quivalent.")])]),e._v(" "),s("h3",{attrs:{id:"configurer-filezilla"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configurer-filezilla"}},[e._v("#")]),e._v(" Configurer FileZilla")]),e._v(" "),s("p",[e._v("Les options par d√©faut de FileZilla font en g√©n√©ral tr√®s bien l'affaire, si bien que nous avons seulement besoin de configurer l'acc√®s √† notre site.")]),e._v(" "),s("p",[e._v("Pour cela, ouvrez le gestionnaire de sites ("),s("code",[e._v("Fichiers > Gestionnaire de sites...")]),e._v(' ou le bouton "Gestionnaire de sites" en haut √† gauche) et entrez les informations requises.')]),e._v(" "),s("p",[s("img",{attrs:{src:"/assets/img/deploy/filezilla-new-site.png",alt:""}})]),e._v(" "),s("ul",[s("li",[e._v("Protocole : FTP ou SFTP sont les deux options les plus courantes (nous allons choisir SFTP)")]),e._v(" "),s("li",[e._v("H√¥te : adresse IP ou nom de domaine fourni par l'h√©bergeur")]),e._v(" "),s("li",[e._v("Chiffrement (apparait si connexion FTP) : vous permet de dire comment chiffrer la connexion (√† voir selon l'h√©bergement)")]),e._v(" "),s("li",[e._v("Type d'authentification : je vous recommande "),s("code",[e._v("Normale")]),e._v(" (qui permet de retenir identifiant "),s("strong",[e._v("et")]),e._v(" mot de passe)")])]),e._v(" "),s("p",[e._v("Une fois les informations entr√©es, plus qu'√† cliquer sur "),s("code",[e._v("Connexion")]),e._v(" pour tester et parcourir les fichiers.")]),e._v(" "),s("h3",{attrs:{id:"transferer-des-fichiers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#transferer-des-fichiers"}},[e._v("#")]),e._v(" Transf√©rer des fichiers")]),e._v(" "),s("p",[e._v("Cette partie est tr√®s simple, il suffit de d√©placer les fichiers d'un c√¥t√© de l'interface √† l'autre.")]),e._v(" "),s("h2",{attrs:{id:"utiliser-ssh-et-git"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#utiliser-ssh-et-git"}},[e._v("#")]),e._v(" Utiliser SSH et Git")]),e._v(" "),s("h3",{attrs:{id:"configurer-openssh"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configurer-openssh"}},[e._v("#")]),e._v(" Configurer OpenSSH")]),e._v(" "),s("p",[e._v("Dans un premier temps, il faut s'assurer d'avoir :")]),e._v(" "),s("ul",[s("li",[e._v("install√© OpenSSH (il faut se rendre dans les fonctionnalit√©s facultatives de Windows)")]),e._v(" "),s("li",[e._v("un agent SSH qui fonctionne (je vous conseille de le faire d√©marrer avec votre syst√®me, en ex√©cutant cette commande "),s("strong",[e._v("dans un powershell, d√©marr√© en tant qu'administrateur")]),e._v(" : "),s("code",[e._v("Set-Service ssh-agent -StartupType Automatic")]),e._v(")")]),e._v(" "),s("li",[e._v("une paire de cl√©s SSH (Utiliser "),s("code",[e._v("ssh-keygen")]),e._v(" pour en g√©n√©rer)")]),e._v(" "),s("li",[e._v("que votre cl√© soit ajout√©e √† votre trousseau en cours ("),s("code",[e._v("ssh-add chemin/vers/la/cl√©/priv√©e")]),e._v(" si √ßa n'est pas le cas)")]),e._v(" "),s("li",[e._v("que la cl√© publique soit ajout√©e √† votre compte GitHub "),s("strong",[e._v("et")]),e._v(" au serveur ("),s("code",[e._v("ssh-copy-id utilisateur@ip-du-serveur")]),e._v(" si √ßa n'est pas d√©j√† fait)")])]),e._v(" "),s("p",[e._v("Si besoin, j'ai √©galement fait une vid√©o sur la configuration d'OpenSSH sous Windows :")]),e._v(" "),s("div",{staticStyle:{position:"relative","padding-bottom":"56.25%",height:"0"}},[s("iframe",{staticStyle:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},attrs:{src:"https://www.loom.com/embed/988ded8daf40416fa5ae9278580f9624",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}})]),e._v(" "),s("h3",{attrs:{id:"deployer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deployer"}},[e._v("#")]),e._v(" D√©ployer")]),e._v(" "),s("p",[e._v("En vid√©o :")]),e._v(" "),s("div",{staticStyle:{position:"relative","padding-bottom":"56.25%",height:"0"}},[s("iframe",{staticStyle:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},attrs:{src:"https://www.loom.com/embed/9e0fc06958dc425bb0dbe600bcdd2d29",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}})]),e._v(" "),s("p",[e._v("Une fois les questions de configuration SSH r√©gl√©es, il faut configurer le serveur (Apache ou Nginx) et mettre en ligne les fichiers.")]),e._v(" "),s("p",[e._v("Pour cette derni√®re √©tape, c'est tr√®s simple, il nous suffit de faire un "),s("code",[e._v("git clone")]),e._v(" de notre projet, pour la premi√®re installation, ou un "),s("code",[e._v("git pull")]),e._v(" par la suite üòÉ .")]),e._v(" "),s("h3",{attrs:{id:"configurer-un-serveur"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configurer-un-serveur"}},[e._v("#")]),e._v(" Configurer un serveur")]),e._v(" "),s("p",[e._v("En vid√©o :")]),e._v(" "),s("div",{staticStyle:{position:"relative","padding-bottom":"56.25%",height:"0"}},[s("iframe",{staticStyle:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%"},attrs:{src:"https://www.loom.com/embed/369d2b7d36ce43f5aa5012c1e097bbb7",frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}})]),e._v(" "),s("p",[e._v("Dans la vid√©o ci-dessus, je vous pr√©sente la configuration avec Nginx, mais je vous renvoie au "),s("RouterLink",{attrs:{to:"/lamp/"}},[e._v("cours sur LAMP")]),e._v(" pour l'installation et la configuration d'un serveur avec Apache, MySQL et Php.")],1),e._v(" "),s("p",[e._v("Des exemples de configuration Nginx, pr√©sent√©s dans la vid√©o :")]),e._v(" "),s("ul",[s("li",[e._v("Une configuration simple, pour afficher un site statique (site en HTML, CSS et JS) :")])]),e._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("server")])]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On indique la racine de nos fichiers.")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("root")]),e._v(" /var/www/formation-hb.drakolab.fr/current/.vuepress/dist")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Par d√©faut, quand on cherche un dossier, on charge ")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# automatiquement le fichier index.html de ce dossier,")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# sans avoir √† l'appeler explicitement.")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("index")]),e._v(" index.html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On d√©fini les domaines qui appelleront le site.")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("server_name")]),e._v(" formation-hb.drakolab.fr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("ul",[s("li",[e._v("Une configuration complexe, pour un site Symfony (r√©cup√©r√©e de "),s("a",{attrs:{href:"https://symfony.com/doc/current/setup/web_server_configuration.html#nginx",target:"_blank",rel:"noopener noreferrer"}},[e._v("la documentation de Symfony"),s("OutboundLink")],1),e._v(") :")])]),e._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("server")])]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On d√©fini les domaines qui appelleront le site.")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Ici, on a 2 domaines et tous leurs sous-domaines.")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("server_name")]),e._v("\n        heureuxdesordre.com *.heureuxdesordre.com\n        heureuxdesordre.fr *.heureuxdesordre.fr")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# La racine de notre site.")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("root")]),e._v(" /var/www/heureuxdesordre.com/current/public")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("location")]),e._v(" /")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Par d√©faut, on essaie de r√©pondre √† la requ√™te en allant chercher ")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# un fichier. Si √ßa n'est pas un fichier, on envoie la requ√™te √† index.php")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Voir le fonctionnement de Symfony et de son Front Controller ;).")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("try_files")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$uri")]),e._v(" /index.php"),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$is_args")]),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$args")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Pour toutes les requ√™tes passant par index.php,")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# on va faire interpr√™ter la requ√™te par Php-fpm")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# (serveur d'application de Php).")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("location")]),e._v(" ~ ^/index\\.php(/|$)")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("fastcgi_pass")]),e._v(" unix:/var/run/php/php7.4-fpm.sock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("fastcgi_split_path_info")]),e._v(" ^(.+\\.php)(/.*)$")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("include")]),e._v(" fastcgi_params")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("fastcgi_param")]),e._v(" SCRIPT_FILENAME "),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$realpath_root")]),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$fastcgi_script_name")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("fastcgi_param")]),e._v(" DOCUMENT_ROOT "),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$realpath_root")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Remove the internal directive to allow URIs like this")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("internal")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Si on cherche √† acc√©der √† un fichier .php (autre que index.php),")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On retourne une erreur 404.")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("location")]),e._v(" ~ \\.php$")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("404")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# On indique o√π vont √™tre stock√© les logs d'erreur et d'acc√®s.")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("error_log")]),e._v(" /var/log/nginx/heureuxdesordre/error.log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("access_log")]),e._v(" /var/log/nginx/heureuxdesordre/access.log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("h2",{attrs:{id:"automatiser-le-deploiement"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#automatiser-le-deploiement"}},[e._v("#")]),e._v(" Automatiser le d√©ploiement")]),e._v(" "),s("p",[e._v("Pour automatiser les d√©ploiements, on se base en g√©n√©ral sur Git et un repository distant (GitHub, GitLab, etc.) et on utilise des outils comme :")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://deployer.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Deployer, pour mettre en ligne, "),s("em",[e._v("via")]),e._v(" SSH"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/banago/PHPloy",target:"_blank",rel:"noopener noreferrer"}},[e._v("PHPloy, pour mettre en ligne, "),s("em",[e._v("via")]),e._v(" FTP"),s("OutboundLink")],1),e._v(".")])]),e._v(" "),s("p",[e._v("L'id√©e est alors de s'assurer d'avoir la derni√®re version de nos fichiers (ainsi que les nouveaux fichiers et les suppressions) pour les mettre en ligne. Les outils SSH permettent √©galement de lancer automatiquement l'ensemble des commandes n√©cessaires √† cette mise √† jour (pour un site Symfony, on a souvent plusieurs commandes √† lancer).")]),e._v(" "),s("h2",{attrs:{id:"resources-utiles"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#resources-utiles"}},[e._v("#")]),e._v(" Resources utiles")]),e._v(" "),s("ul",[s("li",[e._v("Le "),s("a",{attrs:{href:"../lamp"}},[e._v("cours sur LAMP (Apache + MySQL + Php)")])]),e._v(" "),s("li",[s("a",{attrs:{href:"https://e-vinrude.drakolab.fr/cookbooks/debianServerInstall.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Installer un serveur Debian"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://e-vinrude.drakolab.fr/snippets/adminSys/nginx.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Configurer un serveur Nginx"),s("OutboundLink")],1)]),e._v(" "),s("li",[e._v("La "),s("a",{attrs:{href:"https://symfony.com/doc/current/setup/web_server_configuration.html#nginx",target:"_blank",rel:"noopener noreferrer"}},[e._v("documentation de Symfony sur la configuration Nginx"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=n.exports}}]);