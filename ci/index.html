<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Int√©gration continue</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Les formations de R√©mi Jarjat pour Human Booster">
    
    <link rel="preload" href="/assets/css/0.styles.f78ef515.css" as="style"><link rel="preload" href="/assets/js/app.a0283a3d.js" as="script"><link rel="preload" href="/assets/js/2.2bb1f65b.js" as="script"><link rel="preload" href="/assets/js/8.82725242.js" as="script"><link rel="prefetch" href="/assets/js/10.a27b6e9d.js"><link rel="prefetch" href="/assets/js/11.2193e9e3.js"><link rel="prefetch" href="/assets/js/12.f39a5b44.js"><link rel="prefetch" href="/assets/js/13.2d6a44aa.js"><link rel="prefetch" href="/assets/js/14.0673e9ad.js"><link rel="prefetch" href="/assets/js/15.a5eeeada.js"><link rel="prefetch" href="/assets/js/16.33dfc880.js"><link rel="prefetch" href="/assets/js/17.c79025e1.js"><link rel="prefetch" href="/assets/js/18.959ecd03.js"><link rel="prefetch" href="/assets/js/19.9b33ed18.js"><link rel="prefetch" href="/assets/js/20.ef228a5b.js"><link rel="prefetch" href="/assets/js/21.95b935c1.js"><link rel="prefetch" href="/assets/js/22.6089ec44.js"><link rel="prefetch" href="/assets/js/23.1786dcbd.js"><link rel="prefetch" href="/assets/js/24.1cc8c701.js"><link rel="prefetch" href="/assets/js/25.bfc350ad.js"><link rel="prefetch" href="/assets/js/26.bc869606.js"><link rel="prefetch" href="/assets/js/27.2974731f.js"><link rel="prefetch" href="/assets/js/28.c59ffda1.js"><link rel="prefetch" href="/assets/js/29.a4f4f78c.js"><link rel="prefetch" href="/assets/js/3.b306ebdc.js"><link rel="prefetch" href="/assets/js/30.f86e1c24.js"><link rel="prefetch" href="/assets/js/31.3a368f51.js"><link rel="prefetch" href="/assets/js/32.ae32716d.js"><link rel="prefetch" href="/assets/js/33.04577fe2.js"><link rel="prefetch" href="/assets/js/34.0036621d.js"><link rel="prefetch" href="/assets/js/35.ae9cca52.js"><link rel="prefetch" href="/assets/js/36.46328e65.js"><link rel="prefetch" href="/assets/js/37.b265ca29.js"><link rel="prefetch" href="/assets/js/38.30e09b09.js"><link rel="prefetch" href="/assets/js/39.b34ea9f8.js"><link rel="prefetch" href="/assets/js/4.1b3f0ff6.js"><link rel="prefetch" href="/assets/js/40.6ee002ae.js"><link rel="prefetch" href="/assets/js/41.fc420cf4.js"><link rel="prefetch" href="/assets/js/42.209ec249.js"><link rel="prefetch" href="/assets/js/43.2d7d1cd7.js"><link rel="prefetch" href="/assets/js/44.b9fd8430.js"><link rel="prefetch" href="/assets/js/45.15ab68bd.js"><link rel="prefetch" href="/assets/js/46.01b8ec0e.js"><link rel="prefetch" href="/assets/js/47.112cd2f4.js"><link rel="prefetch" href="/assets/js/48.867e58b9.js"><link rel="prefetch" href="/assets/js/49.3ac37d3e.js"><link rel="prefetch" href="/assets/js/5.784f0707.js"><link rel="prefetch" href="/assets/js/50.f9dae8e2.js"><link rel="prefetch" href="/assets/js/51.43768ca2.js"><link rel="prefetch" href="/assets/js/52.dde625a3.js"><link rel="prefetch" href="/assets/js/53.72d8e143.js"><link rel="prefetch" href="/assets/js/54.bc802a1c.js"><link rel="prefetch" href="/assets/js/55.e1f55ab2.js"><link rel="prefetch" href="/assets/js/56.1118b442.js"><link rel="prefetch" href="/assets/js/57.c6e74a85.js"><link rel="prefetch" href="/assets/js/58.cfab71d0.js"><link rel="prefetch" href="/assets/js/59.6fb84388.js"><link rel="prefetch" href="/assets/js/6.a94e70e9.js"><link rel="prefetch" href="/assets/js/60.f130f013.js"><link rel="prefetch" href="/assets/js/61.99515c03.js"><link rel="prefetch" href="/assets/js/62.d3e48f49.js"><link rel="prefetch" href="/assets/js/7.8a7612b0.js"><link rel="prefetch" href="/assets/js/9.8e900de4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f78ef515.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/LogoHB.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Liste des cours</a></li><li><a href="/general/" class="sidebar-link">Culture num√©rique</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/git/" class="sidebar-heading clickable"><span>Git</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/linux/" class="sidebar-link">Linux</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/php/" class="sidebar-heading clickable"><span>PHP</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/symfony/" class="sidebar-heading clickable"><span>Symfony</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/js/" class="sidebar-heading clickable"><span>Javascript</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/lamp/" class="sidebar-link">Serveur Lamp</a></li><li><a href="/deploy/" class="sidebar-link">D√©ploiement</a></li><li><a href="/docker/" class="sidebar-link">Docker</a></li><li><a href="/ci/" aria-current="page" class="active sidebar-link">Int√©gration continue</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ci/#pre-requis" class="sidebar-link">Pr√©-requis</a></li><li class="sidebar-sub-header"><a href="/ci/#definitions" class="sidebar-link">D√©finitions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ci/#devops" class="sidebar-link">DevOps</a></li><li class="sidebar-sub-header"><a href="/ci/#deploiement-continu" class="sidebar-link">D√©ploiement continu</a></li><li class="sidebar-sub-header"><a href="/ci/#integration-continue-2" class="sidebar-link">Int√©gration continue</a></li><li class="sidebar-sub-header"><a href="/ci/#docker" class="sidebar-link">Docker</a></li><li class="sidebar-sub-header"><a href="/ci/#d-autres-outils-utiles" class="sidebar-link">D'autres outils utiles</a></li></ul></li><li class="sidebar-sub-header"><a href="/ci/#gitlab-et-github" class="sidebar-link">GitLab et GitHub</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ci/#revue-de-code" class="sidebar-link">Revue de code</a></li></ul></li><li class="sidebar-sub-header"><a href="/ci/#ci-cd-avec-gitlab" class="sidebar-link">CI / CD avec GitLab</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ci/#un-exemple" class="sidebar-link">Un exemple</a></li><li class="sidebar-sub-header"><a href="/ci/#configuration-du-fichier-de-ci" class="sidebar-link">Configuration du fichier de CI</a></li><li class="sidebar-sub-header"><a href="/ci/#pipelines" class="sidebar-link">Pipelines</a></li><li class="sidebar-sub-header"><a href="/ci/#les-runners" class="sidebar-link">Les runners</a></li><li class="sidebar-sub-header"><a href="/ci/#taches-jobs" class="sidebar-link">T√¢ches / jobs</a></li></ul></li><li class="sidebar-sub-header"><a href="/ci/#ci-cd-avec-github" class="sidebar-link">CI / CD avec GitHub</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ci/#un-workflow-basique" class="sidebar-link">Un Workflow basique</a></li><li class="sidebar-sub-header"><a href="/ci/#utiliser-des-conteneurs-docker" class="sidebar-link">Utiliser des conteneurs Docker</a></li><li class="sidebar-sub-header"><a href="/ci/#partager-des-fichiers" class="sidebar-link">Partager des fichiers</a></li><li class="sidebar-sub-header"><a href="/ci/#aller-plus-loin" class="sidebar-link">Aller plus loin</a></li></ul></li><li class="sidebar-sub-header"><a href="/ci/#exercice-ci-de-notre-projet-symfony" class="sidebar-link">Exercice - CI de notre projet Symfony</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ci/#les-elements-necessaires-a-notre-ci" class="sidebar-link">Les √©l√©ments n√©cessaires √† notre CI</a></li><li class="sidebar-sub-header"><a href="/ci/#des-outils-a-integrer" class="sidebar-link">Des outils √† int√©grer</a></li></ul></li><li class="sidebar-sub-header"><a href="/ci/#exercice-ci-avec-gitlab" class="sidebar-link">Exercice - CI avec GitLab</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ci/#utilisation-des-bases" class="sidebar-link">Utilisation des bases</a></li><li class="sidebar-sub-header"><a href="/ci/#ajout-de-docker" class="sidebar-link">Ajout de Docker</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="integration-continue"><a href="#integration-continue" class="header-anchor">#</a> Int√©gration continue</h1> <h2 id="pre-requis"><a href="#pre-requis" class="header-anchor">#</a> Pr√©-requis</h2> <ul><li>Git</li> <li>GitLab / GitHub / Bitbucket / √©quivalent</li> <li>Yaml (<a href="https://www.codeproject.com/Articles/1214409/Learn-YAML-in-five-minutes" target="_blank" rel="noopener noreferrer">apprendre le YAML en 5 minutes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</li></ul> <h2 id="definitions"><a href="#definitions" class="header-anchor">#</a> D√©finitions</h2> <p>L'introduction en vid√©o :</p> <div style="position:relative;padding-bottom:56.25%;height:0;"><iframe src="https://www.loom.com/embed/85edd5f003384961baa88d784ef2ca9c" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen="allowfullscreen" style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe></div> <h3 id="devops"><a href="#devops" class="header-anchor">#</a> DevOps</h3> <p>Le DevOps est une pratique technique, visant √† unifier le d√©veloppement (logiciel) et l'administration syst√®me (gestion des serveurs).</p> <p>Dans les faits, on parle de DevOps √† la fois pour la pratique et comme m√©tier/sp√©cialisation. Dans les deux cas, il s'agit de mettre en place divers outils, permettant de s'assurer de la qualit√© du produit et du respect du cahier des charges au fur et √† mesure du d√©veloppement.</p> <p>En pratique, cela implique :</p> <ul><li>des cycles de d√©veloppement courts</li> <li>un travail d'√©quipe (relecture du code et mise en place de pratiques communes)</li> <li>la mise en place, d√®s le d√©part, de tests, d'outils de v√©rification de la qualit√© du code ou de la performance, etc. et leur automatisation</li> <li>la mise en place d'environnements de travail au plus pr√®s de l'environnement de production (et lancement des outils automatis√©s dans ce contexte)</li> <li>des mises √† disposition (d√©ploiement) tr√®s r√©guli√®res, que ce soit pour des tests ou en production</li> <li>la surveillance du fonctionnement et de la qualit√© de la production par des m√©triques d√©finies au plus t√¥t.</li></ul> <h3 id="deploiement-continu"><a href="#deploiement-continu" class="header-anchor">#</a> D√©ploiement continu</h3> <p>L'id√©e du d√©ploiement continu est de livrer les nouvelles fonctionnalit√©s au client d√®s qu'elles sont disponibles. Pour cela, on d√©ploie les modifications de mani√®re <strong>automatique</strong> d√®s leur validation (en g√©n√©ral par le client sur un autre environnement) ou leur fusion dans la branche principale.</p> <p>On cherche ainsi √† am√©liorer l'application en continu et cr√©er des cycles courts de d√©veloppement. Chaque d√©ploiement pouvant √™tre annul√© facilement (car peu de modification), on √©vite aussi l'une des grandes contraintes des cycles longs.</p> <h3 id="integration-continue-2"><a href="#integration-continue-2" class="header-anchor">#</a> Int√©gration continue</h3> <p>L'int√©gration continue a pour but de v√©rifier chaque modification du code source, pour √©viter les r√©gressions et autres bugs (autant que possible). Un outil d'int√©gration continue permet de lancer automatiquement diverses actions de v√©rification du projet (compilation, linters, test unitaires et fonctionnels, etc.) ou toute autre t√¢che automatisable (cf
d√©ploiement continu üòâ ).</p> <p>Pour utiliser des outils d'int√©gration continue, il faut que :</p> <ul><li>le code soit versionn√© (git, svn, etc.)</li> <li>des outils de v√©rification automatiques existent dans le projet (compilation, tests, etc.)</li></ul> <p>Si on souhaite mettre en place du d√©ploiement continu (avec ou sans int√©gration continue), il faut que :</p> <ul><li>le projet puisse √™tre mis sur un serveur / sa machine de destination</li> <li>des outils de d√©ploiement aient √©t√© mis en place</li></ul> <h4 id="outils-d-integration-continue"><a href="#outils-d-integration-continue" class="header-anchor">#</a> Outils d'int√©gration continue</h4> <ul><li><a href="https://www.jenkins.io/" target="_blank" rel="noopener noreferrer">Jenkins<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://travis-ci.com/" target="_blank" rel="noopener noreferrer">TravisCI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://cruisecontrol.sourceforge.net/" target="_blank" rel="noopener noreferrer">CruiseControl<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>mais aussi <a href="https://docs.github.com/en/actions" target="_blank" rel="noopener noreferrer">GitHub actions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://bitbucket.org/product/fr/features/pipelines" target="_blank" rel="noopener noreferrer">Bitbucket Pipelines<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ou <a href="https://docs.gitlab.com/ee/ci/" target="_blank" rel="noopener noreferrer">GitLab CI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>Nous allons nous concentrer sur les <a href="https://docs.github.com/en/actions" target="_blank" rel="noopener noreferrer">GitHub actions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> et <a href="https://docs.gitlab.com/ee/ci/" target="_blank" rel="noopener noreferrer">GitLab CI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, qui sont plut√¥t simples √† utiliser et plus rapides √† mettre en place (en plus d'avoir une logique similaire).</p> <h3 id="docker"><a href="#docker" class="header-anchor">#</a> Docker</h3> <p>Docker est un logiciel libre permettant de lancer des applications dans des conteneurs, ayant des t√¢ches sp√©cifiques (en g√©n√©ral, chaque conteneur permet de lancer 1 programme pr√©cis, avec ses d√©pendances directes).</p> <p>Contrairement √† la virtualisation, qui reproduit toutes les caract√©ristiques d'une machine, la conteneurisation s'appuie sur certaines parties de la machine h√¥te (dont le syst√®me d'exploitation) pour fonctionner (ce qui am√©liore grandement la compatibilit√© et la flexibilit√©). Un autre int√©r√™t est de s√©parer compl√®tement l'ex√©cution des diff√©rents services n√©cessaires √† une application (BdD, serveur, etc.), les lan√ßant dans des processus s√©par√©s.</p> <p>Pour plus d'informations sur le sujet, vous pouvez consulter <a href="/docker/">le cours sur Docker, sur ce site</a>.</p> <h3 id="d-autres-outils-utiles"><a href="#d-autres-outils-utiles" class="header-anchor">#</a> D'autres outils utiles</h3> <ul><li><a href="https://gitlab.com/xavki/sommaire-xavki-tutos-fr" target="_blank" rel="noopener noreferrer">Un grand ensemble de tuto DevOps par Xavki<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://phpstan.org/" target="_blank" rel="noopener noreferrer">Un outil d'analyse statique pour Php<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.atlassian.com/fr/git/tutorials/comparing-workflows/gitflow-workflow" target="_blank" rel="noopener noreferrer">Git workflow<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.ansible.com/ansible/latest/index.html" target="_blank" rel="noopener noreferrer">Ansible<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (automatisation de t√¢ches et gestion d'√©tats)</li></ul> <h2 id="gitlab-et-github"><a href="#gitlab-et-github" class="header-anchor">#</a> <a href="https://www.gitlab.com" target="_blank" rel="noopener noreferrer">GitLab<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> et <a href="https://www.github.com" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <p>Une pr√©sentation de GitLab et GitHub en vid√©o :</p> <div style="position:relative;padding-bottom:56.25%;height:0;"><iframe src="https://www.loom.com/embed/294683a858734af694d4b2edcb68d4c5" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen="allowfullscreen" style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe></div> <p>Bien que tout ce qui suit s'applique aussi bien √† Bitbucket, la syntaxe et les denominations changent d'un outil √† l'autre. Les concepts restent les m√™mes et il est plut√¥t ais√© d'adapter ce que vous verrez ici √† d'autres outils de CI/CD.</p> <p>GitLab et GitHub sont des gestionnaires de repositories git en ligne. Ils peuvent servir, entre autre, de :</p> <ul><li>gestionnaire de tickets</li> <li>d'outils de revue de code</li> <li>plateforme de CI/CD</li></ul> <p>Nous allons nous baser sur Git et ses m√©caniques, voici quelques resources pouvant √™tre utiles pour le ma√Ætriser :</p> <ul><li><a href="https://about.gitlab.com/images/press/git-cheat-sheet.pdf" target="_blank" rel="noopener noreferrer">Git Cheat Sheet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (ou <a href="https://github.github.com/training-kit/downloads/fr/github-git-cheat-sheet.pdf" target="_blank" rel="noopener noreferrer">en Fran√ßais<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</li> <li><a href="https://git-scm.com/docs" target="_blank" rel="noopener noreferrer">la documentation officielle<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>une <a href="https://www.atlassian.com/fr/git/tutorials/learn-git-with-bitbucket-cloud" target="_blank" rel="noopener noreferrer">documentation Bitbucket<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> assez compl√®te et en fran√ßais</li></ul> <h3 id="revue-de-code"><a href="#revue-de-code" class="header-anchor">#</a> Revue de code</h3> <p>L'un des grands int√©r√™ts de travailler avec Git (en plus d'avoir un code versionn√©) est de faciliter le travail collaboratif, gr√¢ce notamment aux revues de code.</p> <p>Mais <strong>pourquoi relire le code d'un autre dev ?</strong></p> <ul><li>V√©rifier que la demande initiale est respect√©e</li> <li>Que le code produit r√©pond aux <strong>bonnes pratiques communes</strong></li> <li>Avoir un second (ou troisi√®me, quatri√®me, etc.) point de vue sur le travail effectu√© et trouver d'√©ventuels bugs avant qu'ils ne se d√©voilent au client.</li></ul> <p>Cette revue de code se fait en g√©n√©ral dans les Merge/Pull Requests (MR ou PR) du projet.</p> <h2 id="ci-cd-avec-gitlab"><a href="#ci-cd-avec-gitlab" class="header-anchor">#</a> CI / CD avec GitLab</h2> <p>La <a href="https://docs.gitlab.com/ee/ci/introduction/index.html" target="_blank" rel="noopener noreferrer">documentation officielle de GitLab<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> √† laquelle je vais beaucoup me r√©f√©rer.</p> <p>Pour se faire, notre principal outil va √™tre le fichier <code>.gitlab-ci.yml</code>. C'est dans ce fichier que nous allons d√©finir nos t√¢ches (<code>jobs</code>) et nos √©tapes (<code>stages</code>).</p> <ul><li>L'ensemble des √©tapes forment ce qu'on appelle un <code>Pipeline</code>.</li> <li>Les √©tapes contiennent des t√¢ches. Ce sont des commandes (actions) que l'on va faire lancer √† notre serveur (GitLab).</li> <li>Les t√¢ches sont ex√©cut√©es par des <code>runners</code></li></ul> <h3 id="un-exemple"><a href="#un-exemple" class="header-anchor">#</a> Un exemple</h3> <p>Un exemple de Workflow que nous pouvons construire :</p> <p><img src="https://docs.gitlab.com/ee/ci/introduction/img/gitlab_workflow_example_11_9.png" alt="Un Workflow GitLab : depuis une nouvelle branche, on lance les actions automatiques jusqu'au merge, qui d√©clenche d'autres actions automatiques"></p> <p>La version plus d√©taill√©e :</p> <p><img src="https://docs.gitlab.com/ee/ci/introduction/img/gitlab_workflow_example_extended_v12_3.png" alt="Un Workflow GitLab : depuis une nouvelle branche, on lance les actions automatiques jusqu'au merge, qui d√©clenche d'autres actions automatiques"></p> <p>Que se passe-t-il dans ces images :</p> <ul><li>Un d√©veloppeur cr√©e une branche et cr√©e plusieurs changements (des commits)</li> <li>D√®s que le serveur re√ßoit ses commits (push), un pipeline est lanc√©
<ul><li>ce pipeline contient un ensemble d'√©tapes (stages) qui doivent √™tre valid√©es pour passer √† la suivante</li> <li>chaque √©tape d√©finit plusieurs t√¢ches √† ex√©cuter et, dans notre exemple, certaines t√¢ches cr√©ent une erreur</li></ul></li> <li>Le pipeline renvoie une erreur</li> <li>Le d√©veloppeur cr√©e plusieurs commits pour corriger les diff√©rents probl√®mes et les push</li> <li>Un nouveau pipeline est lanc√©</li> <li>Cette fois, tout fonctionne. L'une des t√¢ches est le d√©ploiement d'une Review App, c‚Äôest-√†-dire le d√©ploiement d'un site permettant de tester la branche, dans des conditions r√©elles (tr√®s utile pour le reviewer de la Merge Request üòâ ).</li> <li>Un(e) autre membre de l'√©quipe relit et teste le code du d√©veloppeur et approuve sa Merge Request</li> <li>La Merge Request est fusionn√©e</li> <li>Un nouveau pipeline est lanc√©
<ul><li>si le projet fait de la livraison continue (<em>Continuous Delivery</em>), une t√¢che peut √™tre lanc√©e (manuellement) pour mettre l'application en production</li> <li>si le projet fait du d√©ploiement continue (<em>Continuous Deployment</em>), cette t√¢che est lanc√©e automatiquement</li></ul></li></ul> <h3 id="configuration-du-fichier-de-ci"><a href="#configuration-du-fichier-de-ci" class="header-anchor">#</a> Configuration du fichier de CI</h3> <p><a href="https://blog.eleven-labs.com/fr/introduction-gitlab-ci/" target="_blank" rel="noopener noreferrer">Mon pense-b√™te favori<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, par Nicolas Gr√©vin de Eleven Labs</p> <p>Son nom et son emplacement sont standard : <code>.gitlab-ci.yml</code> √† la racine du projet Sur GitLab, vous pouvez modifier cela dans : <code>Settings (menu de gauche) &gt; CI/CD &gt; General pipelines &gt; Custom CI config path</code></p> <p>Toutefois, je vous conseille de garder la configuration de base, c'est ce qui est attendu par beaucoup de d√©veloppeurs.</p> <p>Un exemple de fichier <code>.gitlab-ci.yml</code> (celui utilis√© par ce site) :</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># Pour r√©aliser ce fichier, je me suis bas√© sur le tuto d'Eleven Labs : </span>
<span class="token comment"># https://blog.eleven-labs.com/fr/introduction-gitlab-ci/</span>

<span class="token comment"># On d√©finit les diff√©rentes √©tapes (stages) √† faire tourner dans le pipeline</span>
<span class="token key atrule">stages</span><span class="token punctuation">:</span>
  <span class="token comment"># cette √©tape (stage) va compiler l'application, </span>
  <span class="token comment"># permettant de v√©rifier qu'il n'y ait pas d'erreur d√®s la compilation</span>
  <span class="token punctuation">-</span> build
  <span class="token comment"># D√©ploie l'application sur le serveur appropri√©, si n√©cessaire</span>
  <span class="token punctuation">-</span> deploy

<span class="token comment"># On d√©finit une t√¢che (job) qui pourra √™tre lanc√©e lors d'un stage</span>
<span class="token key atrule">pages</span><span class="token punctuation">:</span>
  <span class="token comment"># Ce job sera ex√©cut√© lors du stage build</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
  <span class="token comment"># On va lancer ce job dans un container Docker. </span>
  <span class="token comment"># Ici, une image nodejs de chez Drakona, en version 14 (utilisant Alpine)</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> drakona/node<span class="token punctuation">:</span>14<span class="token punctuation">-</span>alpine
  <span class="token comment"># On met certains dossiers en cache, pour les conserver d'une ex√©cution √† l'autre</span>
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token comment"># Ici, on garde le dossier node_modules, </span>
      <span class="token comment"># afin de ne pas re-t√©l√©charger toutes les d√©pendances √† chaque fois</span>
      <span class="token punctuation">-</span> node_modules/
  <span class="token comment"># Le script que va utiliser ce job. Ici, on profite de notre Makefile !</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> make update build
  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span>
    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> public
  <span class="token comment"># Des tags pour d√©terminer quel runner va ex√©cuter la t√¢che.</span>
  <span class="token comment"># Ici, c'est une configuration personnalis√©e, pour notre GitLab.</span>
  <span class="token comment"># Nous avons cr√©√© nos propres runners</span>
  <span class="token key atrule">tags</span><span class="token punctuation">:</span>
    <span class="token comment"># Pour cette t√¢che, nous allons utiliser un runner utilisant Docker</span>
    <span class="token comment"># Dans notre cas, il y a 6 runners r√©pondant √† ce tag</span>
    <span class="token comment"># Et c'est le premier disponible qui l'ex√©cutera.</span>
    <span class="token punctuation">-</span> docker

<span class="token comment"># Un autre job, qui va d√©ployer notre application sur le serveur de prod</span>
<span class="token key atrule">deploy</span><span class="token punctuation">:</span>
  <span class="token comment"># Avant d'ex√©cuter le script, on va faire un ensemble de commandes,</span>
  <span class="token comment"># pour avoir une cl√© SSH valide et pr√™te √† l'emploi</span>
  <span class="token key atrule">before_script</span><span class="token punctuation">:</span>
    <span class="token comment"># On s'assure que openssh est install√©</span>
    <span class="token punctuation">-</span> <span class="token string">'command -v ssh-agent &gt;/dev/null || ( apt-get update -y &amp;&amp; apt-get install openssh-client -y )'</span>
    <span class="token comment"># On lance le client SSH</span>
    <span class="token punctuation">-</span> eval $(ssh<span class="token punctuation">-</span>agent <span class="token punctuation">-</span>s)
    <span class="token comment"># On va chercher la variable d'environnement DEPLOY_SK, d√©finie dans GitLab</span>
    <span class="token comment"># et qui contient une cl√© priv√©e que l'on va utiliser pour le d√©ploiement</span>
    <span class="token punctuation">-</span> echo &quot;$DEPLOY_SK&quot; <span class="token punctuation">|</span> tr <span class="token punctuation">-</span>d '\r' <span class="token punctuation">|</span> ssh<span class="token punctuation">-</span>add <span class="token punctuation">-</span>
    <span class="token comment"># On s'assure d'avoir un dossier .ssh et qu'il ait des droits corrects</span>
    <span class="token punctuation">-</span> mkdir <span class="token punctuation">-</span>p ~/.ssh
    <span class="token punctuation">-</span> chmod 700 ~/.ssh
  <span class="token comment"># Ce job se lance lors du stage deploy</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> deploy
  <span class="token comment"># Le script √† ex√©cuter</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span> make deploy
  <span class="token comment"># Ce d√©ploiement n'a lieu que si l'on fait une action sur main </span>
  <span class="token comment"># (commit, push, merge, etc.)</span>
  <span class="token key atrule">only</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> main
</code></pre></div><h3 id="pipelines"><a href="#pipelines" class="header-anchor">#</a> Pipelines</h3> <p>Par d√©faut, un pipeline est lanc√© d√®s qu'un nouveau commit est pouss√© (push) sur GitLab (si vous en poussez plusieurs dans la m√™me branche, un seul pipeline sera lanc√©, sur le dernier commit).</p> <p>Vous pouvez voir les pipelines directement dans la partie <code>CI/CD</code> de votre repository, mais ils sont plus pratiques √† d'autres emplacements de l'interface.</p> <p>Sur la partie <code>Project Overview</code> :</p> <p><img src="/assets/img/ci/ci-pipeline-overview.png" alt=""></p> <p>Sur la liste des Merge Requests :</p> <p><img src="/assets/img/ci/ci-pipeline-mr.png" alt=""></p> <p>Ou sur une <code>Merge Request</code> :</p> <p><img src="/assets/img/ci/ci-pipeline-mr2.png" alt=""></p> <p>C'est sur ce dernier affichage que vous pouvez avoir l'adresse pour une <a href="https://docs.gitlab.com/ee/ci/review_apps/" target="_blank" rel="noopener noreferrer">Review App<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, qui est le lien entre une branche de votre repository et un <a href="https://docs.gitlab.com/ee/ci/environments/index.html" target="_blank" rel="noopener noreferrer">environnement<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (un serveur permettant de tester cette branche, en somme).</p> <p><a href="https://docs.gitlab.com/ee/ci/review_apps/" target="_blank" rel="noopener noreferrer">La documentation officielle sur les Review App<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> et <a href="https://docs.gitlab.com/ee/ci/environments/index.html" target="_blank" rel="noopener noreferrer">celle sur les environnements<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="les-runners"><a href="#les-runners" class="header-anchor">#</a> Les runners</h3> <p>Pour lancer les t√¢ches, GitLab utilise des programmes ind√©pendants, les <code>runners</code>. GitLab fourni de nombreux runners et vous permet √©ventuellement d'en cr√©er vous-m√™me, en quelques lignes de commande.</p> <p>Il y a 4 grands types de runners, disponibles par d√©faut :</p> <ul><li>shell (la ligne de commande du serveur)</li> <li>ssh (on ex√©cute nos commandes <em>via</em> SSH sur un autre serveur)</li> <li>docker (on ex√©cute nos commandes dans un container Docker)</li> <li>Kubernetes (on ex√©cute nos commandes dans un environnement Kubernetes)</li></ul> <p>‚ö†Ô∏è Conseil gitlab.com : toujours utiliser docker (avec le tag <code>gitlab-org-docker</code> et une image Docker sur vos t√¢ches, √† moins que vous ne codiez en Ruby üòâ ).</p> <h3 id="taches-jobs"><a href="#taches-jobs" class="header-anchor">#</a> T√¢ches / jobs</h3> <p>Une t√¢che doit toujours lancer un ou des scripts (commandes √† ex√©cuter), tout le reste est optionnel. De nombreuses options permettent de personnaliser les conditions de lancement de la t√¢che, les pr√©-requis, etc. Les diff√©rentes options des t√¢ches :</p> <ul><li>script : d√©claration obligatoire, contenant les commandes √† ex√©cuter</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">pages</span><span class="token punctuation">:</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> make update
    <span class="token punctuation">-</span> make build
</code></pre></div><ul><li>before_script ou after_script : permet d'ex√©cuter une ou des commandes avant ou apr√®s le script de notre t√¢che. Vous pouvez √©galement les d√©finir pour toutes vos t√¢ches, en les pr√©cisant √† la racine</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">before_script</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> echo &quot;avant tous les scripts<span class="token punctuation">,</span> sauf si un before script est d√©fini dans une t√¢che&quot;

<span class="token key atrule">pages</span><span class="token punctuation">:</span>
  <span class="token key atrule">before_script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> echo &quot;avant script&quot;
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> make update
    <span class="token punctuation">-</span> make build
  <span class="token key atrule">after_script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> echo &quot;apr√®s script&quot;
</code></pre></div><ul><li>image : nom d'une image Docker √† utiliser pour ex√©cuter la t√¢che. Peut √™tre √©crit √† la racine pour l'ex√©cution de toutes les t√¢ches.</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># toutes les t√¢ches seront ex√©cut√©es dans des conteneurs nodejs, en version 12</span>
<span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">12</span>

<span class="token key atrule">pages</span><span class="token punctuation">:</span>
  <span class="token comment"># Cette t√¢che sera ex√©cut√©e dans un conteneur php-fpm</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> php<span class="token punctuation">:</span>fpm
</code></pre></div><ul><li>services : permet d'ajouter des conteneurs Docker pour aider dans les t√¢ches (associer une BdD par exemple)</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">pages</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> php<span class="token punctuation">:</span>fpm
  <span class="token comment"># On appelle le service postgres pour acc√©der √† une BdD</span>
  <span class="token key atrule">services</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> postgres
</code></pre></div><ul><li>stages : permet de regrouper les t√¢ches dans des √©tapes :</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># D√©claration des diff√©rentes √©tapes disponibles</span>
<span class="token key atrule">stages</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> build
  <span class="token punctuation">-</span> deploy
  
<span class="token key atrule">pages</span><span class="token punctuation">:</span>
  <span class="token comment"># la t√¢che pages est dans l'√©tape build</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
<span class="token comment">#...</span>
<span class="token key atrule">deploy</span><span class="token punctuation">:</span>
  <span class="token comment"># la t√¢che deploy est dans l'√©tape deploy</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> deploy
</code></pre></div><ul><li>only et except : d√©finition de contraintes d'ex√©cution d'une t√¢che. <code>only</code> peut, par exemple, pr√©ciser qu'on ne lancera la t√¢che que lors d'un <em>push sur master</em>, <code>except</code> que si le push √† lieu sur <em>une branche autre que master</em></li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">deploy-master</span><span class="token punctuation">:</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span> make deploy
  <span class="token key atrule">only</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> master <span class="token comment"># Le job sera effectu√© uniquement lors d‚Äôun √©v√©nement sur la branche master</span>

<span class="token key atrule">test-not-master</span><span class="token punctuation">:</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span> make test
  <span class="token key atrule">except</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> master <span class="token comment"># Le job sera effectu√© sur toutes les branches lors d‚Äôun √©v√©nement sauf sur la branche master</span>

</code></pre></div><ul><li>cache : Mettre des fichiers et des r√©pertoires en cache et qui seront disponible dans le pipeline (ils sont d√©truits apr√®s l'ex√©cution du pipeline, que ce soit un succ√®s ou non)</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">push-cache</span><span class="token punctuation">:</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span> make cache
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token comment"># Chemin des fichiers et dossiers √† conserver</span>
    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> cache <span class="token comment"># r√©pertoire mis en cache</span>
    <span class="token key atrule">policy</span><span class="token punctuation">:</span> push <span class="token comment"># On pr√©cise qu'on ajoute au cache</span>

<span class="token key atrule">pull-cache</span><span class="token punctuation">:</span>
  <span class="token key atrule">script</span><span class="token punctuation">:</span> make somethingWithCache
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> build
    <span class="token key atrule">policy</span><span class="token punctuation">:</span> pull <span class="token comment"># r√©cup√©ration du dossier build dans le cache</span>
</code></pre></div><p>Et beaucoup d'autres, que je vous invite <a href="https://blog.eleven-labs.com/fr/introduction-gitlab-ci/" target="_blank" rel="noopener noreferrer">√† d√©couvrir ici<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> üòâ</p> <h2 id="ci-cd-avec-github"><a href="#ci-cd-avec-github" class="header-anchor">#</a> CI / CD avec GitHub</h2> <p>L'<a href="https://docs.github.com/en/actions/learn-github-actions" target="_blank" rel="noopener noreferrer">introduction officielle aux GitHub Actions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, et la vid√©o qui va avec :</p> <iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/cP0I9w2coGU" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe> <p>‚ö†Ô∏è L'utilisation de GitHub Actions est limit√©e et d√©pend de votre abonnement √† GitHub (pour les projets professionnels d'envergure, un abonnement peut √™tre n√©cessaire, mais pas pour les projets personnels, normalement). Voir <a href="https://docs.github.com/en/actions/reference/usage-limits-billing-and-administration#about-billing-for-github-actions" target="_blank" rel="noopener noreferrer">la documentation officielle sur les limitations de GitHub Actions selon votre abonnement<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="un-workflow-basique"><a href="#un-workflow-basique" class="header-anchor">#</a> Un Workflow basique</h3> <p>Un premier parcours en vid√©o de la doc pour expliquer les diff√©rents termes et le fonctionnement global de GitHub Actions :</p> <div style="position:relative;padding-bottom:56.25%;height:0;"><iframe src="https://www.loom.com/embed/ef665b2420ad4446bb0955772748497a" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen="allowfullscreen" style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe></div> <p>Avec GitHub, on ne parle plus de Pipelines, mais d'Actions. Tout comme avec GitLab, GitHub Actions permet d'ex√©cuter un ensemble de t√¢ches quand un √©v√©nement se produit sur le repository (distant). Le lexique est toutefois assez diff√©rent et il vaut mieux √©viter de m√©langer.</p> <ul><li>Un <strong>Workflow</strong> est une proc√©dure automatique, d√©crivant les diff√©rents Jobs qui vont √™tre lanc√©s quand un Event se produit,</li> <li>un <strong>Event</strong> (push sur le repository, par exemple) on d√©clenche un ou plusieurs Jobs,</li> <li>un <strong>Job</strong> contient des Steps,</li> <li>une <strong>Step</strong> contient des actions,</li> <li>une <strong>Action</strong> est un script (une commande) √† ex√©cuter.</li></ul> <p>Les Jobs sont ex√©cut√©s par des <strong>runners</strong> (et peuvent √™tre diff√©rents pour chaque Job). Un <strong>runner</strong> lance les diff√©rentes actions sur une machine virtuelle (Ubuntu Linux, Microsoft Windows ou macOS). Il est √©galement possible d'utiliser Docker pour lancer nos actions (et nous n'utiliserons que des images officielles).</p> <p><img src="https://docs.github.com/assets/images/help/images/overview-actions-design.png" alt="Un r√©sum√© des composants des Actions GitHub"></p> <p>Pour mettre en place des Workflows, il faut cr√©er un ensemble de fichiers <code>.yml</code> dans le dossier <code>.github/workflows/</code> du projet (en local, donc üòâ ). Ces fichiers peuvent √™tre nomm√© assez librement, mais leur nom doit √™tre toujours en minuscule, et on remplace les espaces par des tirets <code>-</code>.</p> <p>La documentation propose de cr√©er le fichier <code>.github/workflows/learn-github-actions.yml</code>, contenant le code suivant (voir les commentaires pour le d√©tail). Cette commande cr√©e et pr√©pare un environnement nodejs et ex√©cute la commande <code>bats -v</code></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># On donne un nom √† notre Workflow (optionnel). C'est ce nom qui apparaitra sur GitHub</span>
<span class="token key atrule">name</span><span class="token punctuation">:</span> learn<span class="token punctuation">-</span>github<span class="token punctuation">-</span>actions
<span class="token comment"># On donne une liste d'√©v√©nements pour le d√©clencher</span>
<span class="token comment"># Ici, d√®s qu'on push sur le repo distant</span>
<span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">]</span>

<span class="token comment"># On liste les Jobs √† effectuer</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
    <span class="token comment"># On a un seul job : check-bats-version qui va pr√©parer un projet nodejs </span>
    <span class="token comment"># et ex√©cuter une commande</span>
    <span class="token key atrule">check-bats-version</span><span class="token punctuation">:</span>
        <span class="token comment"># Ce job est ex√©cut√© dans une machine virtuelle Ubuntu</span>
        <span class="token comment"># Dans sa derni√®re version.</span>
        <span class="token comment"># Pour l'ex√©cuter dans une version pr√©cise (disons 19.04), il aurait fallu √©crire</span>
        <span class="token comment"># runs-on: ubuntu-19.04</span>
        <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
        <span class="token comment"># On d√©finit les steps (la liste des actions) √† ex√©cuter</span>
        <span class="token key atrule">steps</span><span class="token punctuation">:</span>
            <span class="token comment"># On appelle une action d√©j√† d√©finie par la communaut√© (noter le mot-cl√© uses)</span>
            <span class="token comment"># Ici, c'est une action qui va r√©cup√©rer le code (via git clone, a priori) et nous mettre sur la bonne branche</span>
            <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2
            <span class="token comment"># Une action pour pr√©parer un environnement nodejs</span>
            <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v2
                <span class="token comment"># Avec un param√®tre sp√©cifique : on veut la version 14 de nodejs</span>
                <span class="token key atrule">with</span><span class="token punctuation">:</span>
                  <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">'14'</span>
            <span class="token comment"># On lance une commande (run) pour installer la librairie bats</span>
            <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install <span class="token punctuation">-</span>g bats
            <span class="token comment"># On lance la commande </span>
            <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> bats <span class="token punctuation">-</span>v
</code></pre></div><p>Il est int√©ressant de noter, dans l'exemple ce-dessus, l'usage des mots-cl√©s <code>uses</code> et <code>run</code> :</p> <ul><li><a href="https://docs.github.com/en/actions/learn-github-actions/finding-and-customizing-actions" target="_blank" rel="noopener noreferrer"><code>uses</code> va utiliser un autre fichier, d√©finit par la communaut√©<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (disponible dans les actions de <em>tous</em> les projets) ou par vous-m√™mes (voir plus bas), pour ex√©cuter une ou plusieurs commandes (avec d'√©ventuels param√®tres)</li> <li><code>run</code> va ex√©cuter une commande directement</li></ul> <p>Sachez qu'il est √©galement possible d'√©crire ses propres actions. N'√©tant pas expert dans leur √©criture, je vous renvoie √† <a href="https://docs.github.com/en/actions/creating-actions" target="_blank" rel="noopener noreferrer">la documentation officielle pour la cr√©ation d'actions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Exemple, en vid√©o, de mise en place d'un premier Workflow sur un projet Symfony :</p> <div style="position:relative;padding-bottom:56.25%;height:0;"><iframe src="https://www.loom.com/embed/7f140c95606e44d1b68c35f7aaceddf2" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen="allowfullscreen" style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe></div> <h3 id="utiliser-des-conteneurs-docker"><a href="#utiliser-des-conteneurs-docker" class="header-anchor">#</a> Utiliser des conteneurs Docker</h3> <p>Il est possible de d√©finir des conteneurs pour ex√©cuter utiliser des services suppl√©mentaires dans les actions ou directement pour ex√©cuter les actions elles-m√™mes. Les images √† utiliser et leurs configurations sont d√©finies au niveau du Job.
Le but est ici d'ajouter un ensemble de programmes suppl√©mentaires, non pr√©sent par d√©faut dans la machine virtuelle Ubuntu, pour ex√©cuter certaines t√¢ches</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">container-job</span><span class="token punctuation">:</span>
    <span class="token comment"># On conserve une machine virtuelle de base</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    
    <span class="token comment"># Optionnel : on utilise un conteneur cr√©√© √† partir d'une image php officielle, </span>
    <span class="token comment"># en version 7.4.9. </span>
    <span class="token comment"># Les actions du Job vont √™tre ex√©cut√©es dans ce conteneur</span>
    <span class="token key atrule">container</span><span class="token punctuation">:</span> php<span class="token punctuation">:</span>7.4.9

    <span class="token comment"># On fait appel √† un ou des services suppl√©mentaires, </span>
    <span class="token comment"># qui vont √™tre lanc√©s dans des conteneurs</span>
    <span class="token key atrule">services</span><span class="token punctuation">:</span>
      <span class="token comment"># On donne un nom √† notre service, qu'on utilise dans notre .env </span>
      <span class="token comment"># (c'est l'adresse de la BdD)</span>
      <span class="token key atrule">db</span><span class="token punctuation">:</span>
        <span class="token comment"># On va utiliser l'image mysql (image officielle) en version 5.7</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span>
        <span class="token comment"># On passe des variables d'environnement, pour configurer notre conteneur</span>
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
          <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> pass
          <span class="token key atrule">MYSQL_DATABASE</span><span class="token punctuation">:</span> test

    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token comment"># ... On ex√©cute plusieurs √©tapes n√©cessaires</span>
      
      <span class="token comment"># On ex√©cute une action pour, par exemple, mettre √† jour la BdD</span>
      <span class="token comment"># Attention, notre fichier .env doit avec les bonnes valeurs</span>
      <span class="token comment"># Utilisateur : root</span>
      <span class="token comment"># Mot de passe : pass</span>
      <span class="token comment"># Adresse/IP du serveur : db</span>
      <span class="token comment"># Nom de la base : test</span>
      <span class="token comment"># </span>
      <span class="token comment"># /!\ Mettre √† jour ces √©l√©ments (dans le CI ou le .env) pour adapter √† votre cas !</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Create DB
        <span class="token key atrule">run</span><span class="token punctuation">:</span> php bin/console doctrine<span class="token punctuation">:</span>migrations<span class="token punctuation">:</span>migrate <span class="token punctuation">-</span>n
</code></pre></div><p>‚ö†Ô∏è Vous pouvez √©galement <a href="https://docs.github.com/en/actions/creating-actions/dockerfile-support-for-github-actions" target="_blank" rel="noopener noreferrer">cr√©er vos propres images Docker, mais il faut faire attention √† plusieurs points<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> importants !</p> <h3 id="partager-des-fichiers"><a href="#partager-des-fichiers" class="header-anchor">#</a> Partager des fichiers</h3> <p>Il est possible, au fur et √† mesure de l'ex√©cution de votre Workflow, qu'il faille partager des fichiers, soit entre les jobs, soit en tant que r√©sultat (cr√©ation d'un fichier <code>.jar</code> par exemple). Il est alors possible de <a href="https://docs.github.com/en/actions/guides/storing-workflow-data-as-artifacts" target="_blank" rel="noopener noreferrer">cr√©er des <strong>artifacts</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (nom donn√© aux fichiers cr√©√©s pendant le Workflow), associ√©s √† une ex√©cution de votre Workflow et partag√© entre plusieurs jobs (voir plusieurs ex√©cutions de votre Workflow !).</p> <p>Pour sauvegarder, on utilise <code>actions/upload-artifact</code> (dans sa version 2, dans l'exemple ci-dessous), qui permet de stocker un fichier sur GitHub</p> <p>Pour r√©cup√©rer cette sauvegarde, on utilise <code>actions/download-artifact</code> (dans sa version 2, dans l'exemple ci-dessous), qui permet de r√©cup√©rer des fichiers stock√©s sur GitHub</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">example-job-with-save</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Save output
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token comment"># On lance une commande, qui sauvegarde son r√©sultat dans un fichier</span>
      <span class="token punctuation">-</span> <span class="token key atrule">shell</span><span class="token punctuation">:</span> bash
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          expr 1 + 1 &gt; output.log</span>
      <span class="token comment"># On savegarde ce fichier sur GitHub, en tant qu'artifact</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Upload output file
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/upload<span class="token punctuation">-</span>artifact@v2
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token comment"># On donne un nom √† notre artifact</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> output<span class="token punctuation">-</span>log<span class="token punctuation">-</span>file
          <span class="token comment"># Et un ensemble de fichiers qu'il contient (utiliser Glob ici)</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> output.log
          
  <span class="token key atrule">example-job-with-download</span><span class="token punctuation">:</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token comment"># On va r√©cup√©rer un artifact, pour peut √™tre s'en servir plus tard</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Download a single artifact
        <span class="token key atrule">needs</span><span class="token punctuation">:</span> example<span class="token punctuation">-</span>job<span class="token punctuation">-</span>with<span class="token punctuation">-</span>save
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/download<span class="token punctuation">-</span>artifact@v2
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token comment"># On r√©cup√®re les fichiers par le nom de l'artifact</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> output<span class="token punctuation">-</span>log<span class="token punctuation">-</span>file
</code></pre></div><p>‚ö†Ô∏è Noter <a href="https://docs.github.com/en/actions/learn-github-actions/managing-complex-workflows#creating-dependent-jobs" target="_blank" rel="noopener noreferrer">l'utilisation du mot-cl√© <code>needs</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> pour pr√©ciser que le deuxi√®me job a <em>besoin</em> que le premier ait termin√© son travail. Ce mot-cl√© est tr√®s utile, du moment que vous avez plusieurs jobs, surtout s'ils d√©pendent les uns des autres.</p> <h3 id="aller-plus-loin"><a href="#aller-plus-loin" class="header-anchor">#</a> Aller plus loin</h3> <p>Nous avons ici effleur√© la surface de tout ce qu'il est possible de faire avec les GitHub Actions et je vous invite √† <a href="https://docs.github.com/en/actions" target="_blank" rel="noopener noreferrer">consulter la documentation officielle pour vous faire une id√©e de toutes les possibilit√©s<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> qu'offre cet outil !</p> <h2 id="exercice-ci-de-notre-projet-symfony"><a href="#exercice-ci-de-notre-projet-symfony" class="header-anchor">#</a> Exercice - CI de notre projet Symfony</h2> <p>Pour notre application Symfony, nous allons cr√©er un Workflow / pipeline pour installer et tester le projet. Nous ajouterons ensuite des outils suppl√©mentaires, que nous ajouterons √† notre int√©gration continue.</p> <h3 id="les-elements-necessaires-a-notre-ci"><a href="#les-elements-necessaires-a-notre-ci" class="header-anchor">#</a> Les √©l√©ments n√©cessaires √† notre CI</h3> <ul><li>R√©cup√©rer le code (automatique avec GitLab, requiert une Action avec GitHub)</li> <li>Installer les d√©pendances du projet</li> <li>Cr√©er et initialiser la BdD (migrations + fixtures)</li></ul> <p>Si vous utilisez <strong>GitLab</strong> :</p> <ul><li>D√©finissez les diff√©rentes √©tapes/stages et les fichiers qu'elles doivent partager</li> <li>d√©finissez et impl√©mentez les t√¢ches/jobs demand√©es</li></ul> <p>Si vous utiliser <strong>GitHub</strong> :</p> <ul><li>D√©finissez les diff√©rents jobs</li> <li>D√©finissez les √©tapes et les actions √† effectuer</li> <li>Appelez les actions pr√©-d√©finies ou cr√©ez-en si n√©cessaire</li></ul> <h3 id="des-outils-a-integrer"><a href="#des-outils-a-integrer" class="header-anchor">#</a> Des outils √† int√©grer</h3> <p>Une fois que vous disposez d'une int√©gration continue qui fonctionne, vous √™tes pr√™ts √† rendre votre code plus beau et d'ajouter des outils de v√©rification suppl√©mentaire.</p> <p>Je vous invite √† jeter un oeil √† <a href="https://dev.to/duboiss/symfony-ce-que-j-aurai-aime-savoir-plus-tot-eke" target="_blank" rel="noopener noreferrer">cet article regroupant quelques astuces pouvant √™tre utiles avec Symfony<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><a href="https://github.com/FriendsOfPHP/PHP-CS-Fixer" target="_blank" rel="noopener noreferrer">Php CS Fixer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> : outil de v√©rification de la <strong>forme</strong> du code (attention, on utilise les options <code>--dry-run --diff</code> pour seulement v√©rifier le code, pas le mettre √† jour)</li> <li>Les linters de Symfony, pour v√©rifier nos fichiers de configuration et nos vues (mais aussi <a href="https://symfony.com/doc/current/translation/lint.html" target="_blank" rel="noopener noreferrer">nos fichiers de traduction<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</li> <li><a href="https://github.com/phpstan/phpstan" target="_blank" rel="noopener noreferrer">PhpStan<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> et en particulier <a href="https://github.com/phpstan/phpstan-symfony" target="_blank" rel="noopener noreferrer">PhpStan Symfony<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> : outil d'analyse statique, pour d√©tecter les incoh√©rences du code et trouver des probl√®mes avant qu'ils ne se produisent. Un conseil : pour corriger les erreurs, commencer au niveau 1 et augmenter petit √† petit, jusqu'au niveau 5. Au dela du niveau 5, les erreurs sont bien plus complexes et p√©nibles √† corriger, et vont bien plus loin de ce que vous avez vu de PHP ici.</li></ul> <p>Quelques autres outils, pour les courageux üòâ :</p> <ul><li><a href="https://grafikart.fr/tutoriels/makefile-953" target="_blank" rel="noopener noreferrer">Makefile<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://symfony.com/doc/current/testing.html" target="_blank" rel="noopener noreferrer">PhpUnit<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ou Selenium pour des tests unitaires et/ou fonctionnels (si vous en avez, sinon c'est l'occasion de tester üòâ )</li> <li>Si votre projet utilise npm :
<ul><li>lancer l'installation des paquets</li> <li>utiliser les commandes n√©cessaires au fonctionnement du projet (compilation des fichiers Sass, appel √† Webpack, etc.)</li></ul></li></ul> <h2 id="exercice-ci-avec-gitlab"><a href="#exercice-ci-avec-gitlab" class="header-anchor">#</a> Exercice - CI avec GitLab</h2> <h3 id="utilisation-des-bases"><a href="#utilisation-des-bases" class="header-anchor">#</a> Utilisation des bases</h3> <p>Dans un premier temps, nous allons cr√©er une int√©gration continue fictive, avec des echos comme scripts.</p> <p>Dans une nouvelle branche Git, construire un pipeline respectant les consignes suivantes (les scripts sont indiqu√©s entre parenth√®ses) :</p> <ul><li><p>des t√¢ches</p> <ul><li>composer (<code>echo 'composer install'</code>)</li> <li>database (<code>echo &quot;cr√©ation d'une BdD et ex√©cution des migrations et fixtures&quot;</code>)</li> <li>tests unitaires (<code>echo 'tests unitaires'</code>)</li> <li>tests fonctionnels (<code>echo 'tests fonctionnels'</code>)</li> <li>d√©ploiement prod (<code>echo 'd√©ploiement prod'</code>), uniquement sur la branche main / master (votre branche principale) et √† d√©clencher manuellement (ne doit pas √™tre lanc√©e automatiquement)</li> <li>d√©ploiement d√©mo (<code>echo 'd√©ploiement d√©mo'</code>), uniquement sur la branche principale</li> <li>d√©ploiement App Review (<code>echo 'd√©ploiement app review'</code>), sur les branches autres que votre branche principale</li></ul></li> <li><p>des √©tapes :</p> <ul><li><code>build</code> qui contiendra les t√¢ches <code>composer</code> et <code>database</code></li> <li><code>test</code> qui contiendra les t√¢ches de tests unitaires et fonctionnels</li> <li><code>deploy</code> qui contiendra les t√¢ches de d√©ploiement (prod, d√©mo et App Review)</li></ul></li></ul> <p>Pour tester votre pipeline, faites un push de cette branche üòâ .</p> <p>Question suppl√©mentaire, n√©cessaire pour la suite : comment faire en sorte de ne pas avoir √† faire un <code>composer install</code> et de mettre en place la BdD pour chaque t√¢che ?</p> <h3 id="ajout-de-docker"><a href="#ajout-de-docker" class="header-anchor">#</a> Ajout de Docker</h3> <p>Maintenant, nous allons mettre en place des scripts r√©els. Pour cela, nous allons √©galement utiliser 2 images Docker :</p> <ul><li><p><code>drakona/php:7.4-symfony</code> en tant qu'image pour toutes nos t√¢ches</p></li> <li><p><code>mysql:5.7</code> en tant que service, pour obtenir une BdD</p></li> <li><p>Comment configurer MySQL ? (voir documentation de l'image mysql sur DockerHub)</p></li> <li><p>Comment avoir la bonne configuration dans le fichier <code>.env</code> pendant le pipeline ?</p></li> <li><p>Ajouter les scripts r√©els :</p> <ul><li>la t√¢che <code>composer</code> doit lancer un <code>composer install</code></li> <li>la t√¢che <code>database</code> doit lancer les migrations et les fixtures</li></ul></li></ul> <p>Pour le moment, les autres t√¢ches vont continuer √† faire des <code>echo</code></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ‚Üê
      <a href="/docker/" class="prev">
        Docker
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.a0283a3d.js" defer></script><script src="/assets/js/2.2bb1f65b.js" defer></script><script src="/assets/js/8.82725242.js" defer></script>
  </body>
</html>
