<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Les controllers</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Les formations de Rémi Jarjat pour Human Booster">
    
    <link rel="preload" href="/assets/css/0.styles.f78ef515.css" as="style"><link rel="preload" href="/assets/js/app.a0283a3d.js" as="script"><link rel="preload" href="/assets/js/2.2bb1f65b.js" as="script"><link rel="preload" href="/assets/js/45.15ab68bd.js" as="script"><link rel="prefetch" href="/assets/js/10.a27b6e9d.js"><link rel="prefetch" href="/assets/js/11.2193e9e3.js"><link rel="prefetch" href="/assets/js/12.f39a5b44.js"><link rel="prefetch" href="/assets/js/13.2d6a44aa.js"><link rel="prefetch" href="/assets/js/14.0673e9ad.js"><link rel="prefetch" href="/assets/js/15.a5eeeada.js"><link rel="prefetch" href="/assets/js/16.33dfc880.js"><link rel="prefetch" href="/assets/js/17.c79025e1.js"><link rel="prefetch" href="/assets/js/18.959ecd03.js"><link rel="prefetch" href="/assets/js/19.9b33ed18.js"><link rel="prefetch" href="/assets/js/20.ef228a5b.js"><link rel="prefetch" href="/assets/js/21.95b935c1.js"><link rel="prefetch" href="/assets/js/22.6089ec44.js"><link rel="prefetch" href="/assets/js/23.1786dcbd.js"><link rel="prefetch" href="/assets/js/24.1cc8c701.js"><link rel="prefetch" href="/assets/js/25.bfc350ad.js"><link rel="prefetch" href="/assets/js/26.bc869606.js"><link rel="prefetch" href="/assets/js/27.2974731f.js"><link rel="prefetch" href="/assets/js/28.c59ffda1.js"><link rel="prefetch" href="/assets/js/29.a4f4f78c.js"><link rel="prefetch" href="/assets/js/3.b306ebdc.js"><link rel="prefetch" href="/assets/js/30.f86e1c24.js"><link rel="prefetch" href="/assets/js/31.3a368f51.js"><link rel="prefetch" href="/assets/js/32.ae32716d.js"><link rel="prefetch" href="/assets/js/33.04577fe2.js"><link rel="prefetch" href="/assets/js/34.0036621d.js"><link rel="prefetch" href="/assets/js/35.ae9cca52.js"><link rel="prefetch" href="/assets/js/36.46328e65.js"><link rel="prefetch" href="/assets/js/37.b265ca29.js"><link rel="prefetch" href="/assets/js/38.30e09b09.js"><link rel="prefetch" href="/assets/js/39.b34ea9f8.js"><link rel="prefetch" href="/assets/js/4.1b3f0ff6.js"><link rel="prefetch" href="/assets/js/40.6ee002ae.js"><link rel="prefetch" href="/assets/js/41.fc420cf4.js"><link rel="prefetch" href="/assets/js/42.209ec249.js"><link rel="prefetch" href="/assets/js/43.2d7d1cd7.js"><link rel="prefetch" href="/assets/js/44.b9fd8430.js"><link rel="prefetch" href="/assets/js/46.01b8ec0e.js"><link rel="prefetch" href="/assets/js/47.112cd2f4.js"><link rel="prefetch" href="/assets/js/48.867e58b9.js"><link rel="prefetch" href="/assets/js/49.3ac37d3e.js"><link rel="prefetch" href="/assets/js/5.784f0707.js"><link rel="prefetch" href="/assets/js/50.f9dae8e2.js"><link rel="prefetch" href="/assets/js/51.43768ca2.js"><link rel="prefetch" href="/assets/js/52.dde625a3.js"><link rel="prefetch" href="/assets/js/53.72d8e143.js"><link rel="prefetch" href="/assets/js/54.bc802a1c.js"><link rel="prefetch" href="/assets/js/55.e1f55ab2.js"><link rel="prefetch" href="/assets/js/56.1118b442.js"><link rel="prefetch" href="/assets/js/57.c6e74a85.js"><link rel="prefetch" href="/assets/js/58.cfab71d0.js"><link rel="prefetch" href="/assets/js/59.6fb84388.js"><link rel="prefetch" href="/assets/js/6.a94e70e9.js"><link rel="prefetch" href="/assets/js/60.f130f013.js"><link rel="prefetch" href="/assets/js/61.99515c03.js"><link rel="prefetch" href="/assets/js/62.d3e48f49.js"><link rel="prefetch" href="/assets/js/7.8a7612b0.js"><link rel="prefetch" href="/assets/js/8.82725242.js"><link rel="prefetch" href="/assets/js/9.8e900de4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f78ef515.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/LogoHB.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Liste des cours</a></li><li><a href="/general/" class="sidebar-link">Culture numérique</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/git/" class="sidebar-heading clickable"><span>Git</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/linux/" class="sidebar-link">Linux</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/php/" class="sidebar-heading clickable"><span>PHP</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/symfony/" class="sidebar-heading clickable router-link-active open"><span>Symfony</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/symfony/01-installation.html" class="sidebar-link">Installer Symfony et son environnement de travail</a></li><li><a href="/symfony/10-structure.html" class="sidebar-link">Structure et utilisation d'un projet</a></li><li><a href="/symfony/20-routing.html" class="sidebar-link">Le routing</a></li><li><a href="/symfony/21-controllers.html" aria-current="page" class="active sidebar-link">Les controllers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/symfony/21-controllers.html#pour-resumer" class="sidebar-link">Pour résumer</a></li><li class="sidebar-sub-header"><a href="/symfony/21-controllers.html#definition-et-premier-exemple" class="sidebar-link">Définition et premier exemple</a></li><li class="sidebar-sub-header"><a href="/symfony/21-controllers.html#utiliser-les-routes" class="sidebar-link">Utiliser les routes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/symfony/21-controllers.html#rendre-une-vue-twig" class="sidebar-link">Rendre une vue Twig</a></li></ul></li><li class="sidebar-sub-header"><a href="/symfony/21-controllers.html#de-buguer" class="sidebar-link">Dé-buguer</a></li></ul></li><li><a href="/symfony/22-twig.html" class="sidebar-link">Twig</a></li><li><a href="/symfony/23-injection.html" class="sidebar-link">Les services et l'injection de dépendances</a></li><li><a href="/symfony/24-doctrine.html" class="sidebar-link">Doctrine et la BdD</a></li><li><a href="/symfony/25-formulaires.html" class="sidebar-link">Formulaires</a></li><li><a href="/symfony/26-translation.html" class="sidebar-link">Les traductions</a></li><li><a href="/symfony/27-event-listeners.html" class="sidebar-link">Event listeners/subscribers</a></li><li><a href="/symfony/30-user.html" class="sidebar-link">Connexion et sécurisation</a></li><li><a href="/symfony/40-bundles.html" class="sidebar-link">Bundles</a></li><li><a href="/symfony/41-easy-admin.html" class="sidebar-link">Easy Admin Bundle</a></li><li><a href="/symfony/42-api-platform.html" class="sidebar-link">Api Platform</a></li><li><a href="/symfony/80-cheat-sheet.html" class="sidebar-link">Pense-bêtes</a></li><li><a href="/symfony/81-quotidien.html" class="sidebar-link">Symfony au quotidien</a></li><li><a href="/symfony/82-docker.html" class="sidebar-link">Travailler avec Docker</a></li><li><a href="/symfony/90-doggies.html" class="sidebar-link">Projet : annonces de SPA / éleveurs</a></li><li><a href="/symfony/91-vote.html" class="sidebar-link">Projet : vote citoyen</a></li><li><a href="/symfony/99-exercices.html" class="sidebar-link">Exercices</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/js/" class="sidebar-heading clickable"><span>Javascript</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/lamp/" class="sidebar-link">Serveur Lamp</a></li><li><a href="/deploy/" class="sidebar-link">Déploiement</a></li><li><a href="/docker/" class="sidebar-link">Docker</a></li><li><a href="/ci/" class="sidebar-link">Intégration continue</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="les-controllers"><a href="#les-controllers" class="header-anchor">#</a> Les controllers</h1> <div style="position:relative;padding-bottom:56.25%;height:0;"><iframe src="https://www.loom.com/embed/12a92f13e0354bfcbfc291f50222ca51" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen="allowfullscreen" style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe></div> <h2 id="pour-resumer"><a href="#pour-resumer" class="header-anchor">#</a> Pour résumer</h2> <ul><li>Le controller est un service, chargé de transformer une requête HTTP (<code>Request</code>) en une réponse HTTP (<code>Response</code>) à renvoyer à l'utilisateur</li> <li>Il fait appel à différents services (<code>Twig</code>, <code>Doctrine</code>, etc.) pour cela</li> <li>Chacune de ses méthodes (appelées actions), est liée à un chemin grâce à une route (voir chapitre précédent)</li> <li>On peut injecter des services (<code>Request</code>, <code>Repository</code>, <code>EntityManagerInterface</code>, etc.) soit dans son contructeur, soit en paramètre des actions</li> <li><code>php bin/console make:controller</code> permet de générer un controller, avec une action et une vue associée (rendue avec Twig)</li> <li>Utiliser <code>dump()</code> et <code>dd()</code> (dump and die) pour afficher les informations sur vos variables</li></ul> <h2 id="definition-et-premier-exemple"><a href="#definition-et-premier-exemple" class="header-anchor">#</a> Définition et premier exemple</h2> <p>On appelle Controller (ou contrôleur en français) une fonction traitant les données de la requête HTTP et renvoyant une réponse au navigateur (la plupart du temps, une page web). Contrairement à cette définition (globale à PHP et d'autres langages), avec Symfony, on parle de controller pour désigner la classe contenant des actions (au sens strict, ce sont ces actions que l'on devrait appeler controllers).</p> <p>Dans la pratique, une classe Controller va contenir plusieurs méthodes (actions), qui vont correspondre à des routes (urls, comme nous l'avons vu plus haut). Ces actions vont recevoir toutes les informations de la requête (objet <code>Request</code> de Symfony) et envoyer une réponse (objet <code>Response</code> de Symfony, ou l'un de ses enfants).</p> <p>Commande utile pour générer un Controller : <code>php bin/console make:controller</code></p> <p>Décomposons et complétons notre exemple précédent (⚠️ on utilise généralement Twig pour générer du HTML, voir plus bas) :</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// src/Controller/BlogController.php</span>
<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Bundle<span class="token punctuation">\</span>FrameworkBundle<span class="token punctuation">\</span>Controller<span class="token punctuation">\</span>AbstractController</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>Response</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Routing<span class="token punctuation">\</span>Annotation<span class="token punctuation">\</span>Route</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Route(host=&quot;blog.example.com&quot;, requirements={&quot;_locale&quot;: &quot;en|es|fr&quot;}, name=&quot;blog_&quot;)
 */</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">BlogController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractController</span> <span class="token comment">// Notre controller hérite du AbstractController de Symfony, ce qui nous permet d'avoir plusieurs méthodes très utiles. Ca n'est toutefois pas obligatoire, nous pourrions tout à fait définir des controllers qui n'étendent pas AbstractController.</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * @Route(&quot;/{_locale}&quot;, name=&quot;list&quot;)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Disons que nous avons une liste d'articles de blog</span>
        <span class="token variable">$posts</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token comment">// Des articles</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// On prépare le html à afficher à l'utilisateur</span>
        <span class="token variable">$html</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;html&gt;&lt;body&gt;Articles : '</span><span class="token operator">.</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token variable">$posts</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;/body&gt;&lt;/html&gt;'</span><span class="token punctuation">;</span>
        
        <span class="token comment">// On préparer un objet Response qui va non seulement contenir notre html, mais également toutes les informations HTTP nécessaires (headers par exemple)</span>
        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token variable">$html</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// On renvoie la réponse destinée au navigateur</span>
        <span class="token keyword">return</span> <span class="token variable">$response</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="utiliser-les-routes"><a href="#utiliser-les-routes" class="header-anchor">#</a> Utiliser les routes</h2> <p>Dans les controllers, nous n'utilisons les routes que par leur nom (ce qui évite également d'avoir à se rappeler des informations autres, comme l'URi correspondante).
Pour récupérer l'url vers une route, le <code>AbstractController</code> nous fournit la méthode <code>generateUrl()</code> :</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$englishUrl</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">generateUrl</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'blog_list'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'_locale'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'en'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$frenchUrl</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">generateUrl</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'blog_list'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'_locale'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'fr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Il existe également plusieurs méthodes pour rediriger l'utilisateur vers une autre page (on renvoie alors l'un des enfants de l'objet <code>Response</code> : <code>RedirectResponse</code>) :</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>RedirectResponse</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">RedirectResponse</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Redirige vers la route &quot;homepage&quot;</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">redirectToRoute</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'homepage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// redirectToRoute est un raccourci pour :</span>
    <span class="token comment">// return new RedirectResponse($this-&gt;generateUrl('homepage'));</span>

    <span class="token comment">// Redirige de manière permanente vers la route &quot;homepage&quot; (Voir le statut HTTP 301)</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">redirectToRoute</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'homepage'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">301</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Redirige vers une route avec un paramètre</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">redirectToRoute</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'blog_index'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span> <span class="token operator">=&gt;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Redirige vers une route avec tous les paramètres $_GET présents</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">redirectToRoute</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'blog_index'</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token property">query</span><span class="token operator">-&gt;</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Redirige vers une page externe au site</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'http://symfony.com/doc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="rendre-une-vue-twig"><a href="#rendre-une-vue-twig" class="header-anchor">#</a> Rendre une vue Twig</h3> <p>La classe <code>AbstractController</code> fournit une méthode <code>render()</code> qui nous permet de générer une <code>Response</code> à partir d'un fichier Twig (et donc de compiler ce dernier).</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Ici, on va récupérer notre template dans `templates/blog/index.html.twig`</span>
<span class="token comment">// Il est compilé (transformé, à l'aide de nos paramètres, en HTML) et renvoyé dans un objet Response</span>
<span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'blog/index.html.twig'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span> <span class="token operator">=&gt;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Pour <a href="">plus d'informations sur le fonctionnement de Twig, voir la partie dédiée</a>.</p> <h2 id="de-buguer"><a href="#de-buguer" class="header-anchor">#</a> Dé-buguer</h2> <p>Avec Symfony, vous pouvez dé-buguer vos programmes de plusieurs manières :</p> <ul><li>Utiliser <code>exit</code>/<code>die</code> et <code>var_dump</code> comme nous l'avons fait jusqu'à présent (déconseillé si xDebug n'est pas installé et utilisable par la ligne de commande Symfony)</li> <li>Utiliser <code>dump()</code> et <code>dd()</code> (dump and die) pour afficher les informations sur vos variables</li></ul> <p>Ces fonctions <code>dump()</code> et <code>dd()</code> sont disponibles dans n'importe quel fichier PHP de votre projet.
La fonction <code>dump</code> ne va pas interrompre l'affichage ni le modifier, mais afficher un dump des variables demandées dans le <code>Profiler</code> de Symfony (la barre grise en bas de l'écran, quand vous chargez une page)</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/symfony/20-routing.html" class="prev">
        Le routing
      </a></span> <span class="next"><a href="/symfony/22-twig.html">
        Twig
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.a0283a3d.js" defer></script><script src="/assets/js/2.2bb1f65b.js" defer></script><script src="/assets/js/45.15ab68bd.js" defer></script>
  </body>
</html>
