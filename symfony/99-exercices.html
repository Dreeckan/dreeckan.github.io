<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Exercices</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Les formations de Rémi Jarjat pour Human Booster">
    
    <link rel="preload" href="/assets/css/0.styles.f78ef515.css" as="style"><link rel="preload" href="/assets/js/app.a0283a3d.js" as="script"><link rel="preload" href="/assets/js/2.2bb1f65b.js" as="script"><link rel="preload" href="/assets/js/61.99515c03.js" as="script"><link rel="prefetch" href="/assets/js/10.a27b6e9d.js"><link rel="prefetch" href="/assets/js/11.2193e9e3.js"><link rel="prefetch" href="/assets/js/12.f39a5b44.js"><link rel="prefetch" href="/assets/js/13.2d6a44aa.js"><link rel="prefetch" href="/assets/js/14.0673e9ad.js"><link rel="prefetch" href="/assets/js/15.a5eeeada.js"><link rel="prefetch" href="/assets/js/16.33dfc880.js"><link rel="prefetch" href="/assets/js/17.c79025e1.js"><link rel="prefetch" href="/assets/js/18.959ecd03.js"><link rel="prefetch" href="/assets/js/19.9b33ed18.js"><link rel="prefetch" href="/assets/js/20.ef228a5b.js"><link rel="prefetch" href="/assets/js/21.95b935c1.js"><link rel="prefetch" href="/assets/js/22.6089ec44.js"><link rel="prefetch" href="/assets/js/23.1786dcbd.js"><link rel="prefetch" href="/assets/js/24.1cc8c701.js"><link rel="prefetch" href="/assets/js/25.bfc350ad.js"><link rel="prefetch" href="/assets/js/26.bc869606.js"><link rel="prefetch" href="/assets/js/27.2974731f.js"><link rel="prefetch" href="/assets/js/28.c59ffda1.js"><link rel="prefetch" href="/assets/js/29.a4f4f78c.js"><link rel="prefetch" href="/assets/js/3.b306ebdc.js"><link rel="prefetch" href="/assets/js/30.f86e1c24.js"><link rel="prefetch" href="/assets/js/31.3a368f51.js"><link rel="prefetch" href="/assets/js/32.ae32716d.js"><link rel="prefetch" href="/assets/js/33.04577fe2.js"><link rel="prefetch" href="/assets/js/34.0036621d.js"><link rel="prefetch" href="/assets/js/35.ae9cca52.js"><link rel="prefetch" href="/assets/js/36.46328e65.js"><link rel="prefetch" href="/assets/js/37.b265ca29.js"><link rel="prefetch" href="/assets/js/38.30e09b09.js"><link rel="prefetch" href="/assets/js/39.b34ea9f8.js"><link rel="prefetch" href="/assets/js/4.1b3f0ff6.js"><link rel="prefetch" href="/assets/js/40.6ee002ae.js"><link rel="prefetch" href="/assets/js/41.fc420cf4.js"><link rel="prefetch" href="/assets/js/42.209ec249.js"><link rel="prefetch" href="/assets/js/43.2d7d1cd7.js"><link rel="prefetch" href="/assets/js/44.b9fd8430.js"><link rel="prefetch" href="/assets/js/45.15ab68bd.js"><link rel="prefetch" href="/assets/js/46.01b8ec0e.js"><link rel="prefetch" href="/assets/js/47.112cd2f4.js"><link rel="prefetch" href="/assets/js/48.867e58b9.js"><link rel="prefetch" href="/assets/js/49.3ac37d3e.js"><link rel="prefetch" href="/assets/js/5.784f0707.js"><link rel="prefetch" href="/assets/js/50.f9dae8e2.js"><link rel="prefetch" href="/assets/js/51.43768ca2.js"><link rel="prefetch" href="/assets/js/52.dde625a3.js"><link rel="prefetch" href="/assets/js/53.72d8e143.js"><link rel="prefetch" href="/assets/js/54.bc802a1c.js"><link rel="prefetch" href="/assets/js/55.e1f55ab2.js"><link rel="prefetch" href="/assets/js/56.1118b442.js"><link rel="prefetch" href="/assets/js/57.c6e74a85.js"><link rel="prefetch" href="/assets/js/58.cfab71d0.js"><link rel="prefetch" href="/assets/js/59.6fb84388.js"><link rel="prefetch" href="/assets/js/6.a94e70e9.js"><link rel="prefetch" href="/assets/js/60.f130f013.js"><link rel="prefetch" href="/assets/js/62.d3e48f49.js"><link rel="prefetch" href="/assets/js/7.8a7612b0.js"><link rel="prefetch" href="/assets/js/8.82725242.js"><link rel="prefetch" href="/assets/js/9.8e900de4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f78ef515.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/LogoHB.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Liste des cours</a></li><li><a href="/general/" class="sidebar-link">Culture numérique</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/git/" class="sidebar-heading clickable"><span>Git</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/linux/" class="sidebar-link">Linux</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/php/" class="sidebar-heading clickable"><span>PHP</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/symfony/" class="sidebar-heading clickable router-link-active open"><span>Symfony</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/symfony/01-installation.html" class="sidebar-link">Installer Symfony et son environnement de travail</a></li><li><a href="/symfony/10-structure.html" class="sidebar-link">Structure et utilisation d'un projet</a></li><li><a href="/symfony/20-routing.html" class="sidebar-link">Le routing</a></li><li><a href="/symfony/21-controllers.html" class="sidebar-link">Les controllers</a></li><li><a href="/symfony/22-twig.html" class="sidebar-link">Twig</a></li><li><a href="/symfony/23-injection.html" class="sidebar-link">Les services et l'injection de dépendances</a></li><li><a href="/symfony/24-doctrine.html" class="sidebar-link">Doctrine et la BdD</a></li><li><a href="/symfony/25-formulaires.html" class="sidebar-link">Formulaires</a></li><li><a href="/symfony/26-translation.html" class="sidebar-link">Les traductions</a></li><li><a href="/symfony/27-event-listeners.html" class="sidebar-link">Event listeners/subscribers</a></li><li><a href="/symfony/30-user.html" class="sidebar-link">Connexion et sécurisation</a></li><li><a href="/symfony/40-bundles.html" class="sidebar-link">Bundles</a></li><li><a href="/symfony/41-easy-admin.html" class="sidebar-link">Easy Admin Bundle</a></li><li><a href="/symfony/42-api-platform.html" class="sidebar-link">Api Platform</a></li><li><a href="/symfony/80-cheat-sheet.html" class="sidebar-link">Pense-bêtes</a></li><li><a href="/symfony/81-quotidien.html" class="sidebar-link">Symfony au quotidien</a></li><li><a href="/symfony/82-docker.html" class="sidebar-link">Travailler avec Docker</a></li><li><a href="/symfony/90-doggies.html" class="sidebar-link">Projet : annonces de SPA / éleveurs</a></li><li><a href="/symfony/91-vote.html" class="sidebar-link">Projet : vote citoyen</a></li><li><a href="/symfony/99-exercices.html" aria-current="page" class="active sidebar-link">Exercices</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/symfony/99-exercices.html#_1-creer-une-premiere-page-avec-symfony-exercice-guide" class="sidebar-link">1. Créer une première page avec Symfony (exercice guidé)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/symfony/99-exercices.html#resolution" class="sidebar-link">Résolution</a></li></ul></li><li class="sidebar-sub-header"><a href="/symfony/99-exercices.html#_2-exercice-apprivoiser-le-controller-et-la-vue" class="sidebar-link">2. Exercice (apprivoiser le controller et la vue)</a></li><li class="sidebar-sub-header"><a href="/symfony/99-exercices.html#_3-exercice-apprivoiser-twig-et-sa-documentation" class="sidebar-link">3. Exercice (apprivoiser Twig et sa documentation)</a></li><li class="sidebar-sub-header"><a href="/symfony/99-exercices.html#_4-manier-des-assets-les-controllers-et-twig" class="sidebar-link">4. Manier des assets, les controllers et Twig</a></li><li class="sidebar-sub-header"><a href="/symfony/99-exercices.html#_5-manier-doctrine-pour-utiliser-une-bdd" class="sidebar-link">5. Manier Doctrine pour utiliser une BdD</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/symfony/99-exercices.html#_5-1-configuration-et-creation-de-la-base" class="sidebar-link">5.1. Configuration et création de la base</a></li><li class="sidebar-sub-header"><a href="/symfony/99-exercices.html#_5-2-creation-d-entites-et-de-leurs-champs" class="sidebar-link">5.2. Création d'entités et de leurs champs</a></li><li class="sidebar-sub-header"><a href="/symfony/99-exercices.html#_5-3-migration" class="sidebar-link">5.3. Migration</a></li><li class="sidebar-sub-header"><a href="/symfony/99-exercices.html#_5-4-utiliser-ces-entites-dans-les-controllers" class="sidebar-link">5.4. Utiliser ces entités dans les controllers</a></li></ul></li><li class="sidebar-sub-header"><a href="/symfony/99-exercices.html#_6-manier-le-querybuilder" class="sidebar-link">6. Manier le QueryBuilder</a></li><li class="sidebar-sub-header"><a href="/symfony/99-exercices.html#_7-projet-outil-de-montage-d-ordinateurs" class="sidebar-link">7. Projet : outil de montage d'ordinateurs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/symfony/99-exercices.html#_7-1-premieres-ameliorations" class="sidebar-link">7.1. Premières améliorations</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/js/" class="sidebar-heading clickable"><span>Javascript</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/lamp/" class="sidebar-link">Serveur Lamp</a></li><li><a href="/deploy/" class="sidebar-link">Déploiement</a></li><li><a href="/docker/" class="sidebar-link">Docker</a></li><li><a href="/ci/" class="sidebar-link">Intégration continue</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="exercices"><a href="#exercices" class="header-anchor">#</a> Exercices</h1> <p>Une <a href="https://gitlab.com/drakona-formation/exercices-symfony-cda17" target="_blank" rel="noopener noreferrer">autre série d'exercices est disponible sur Gitlab<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (annonces d'adoption de chiens)</p> <p>La correction de ces exercices est disponible sur un <a href="https://github.com/Dreeckan/test-symfony" target="_blank" rel="noopener noreferrer">repository Github dédié<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_1-creer-une-premiere-page-avec-symfony-exercice-guide"><a href="#_1-creer-une-premiere-page-avec-symfony-exercice-guide" class="header-anchor">#</a> 1. Créer une première page avec Symfony (exercice guidé)</h2> <ul><li>Avoir un projet Symfony neuf (fraîchement créé, sans modification)</li> <li>Créer une page qui va être disponible sur l'uri <code>/page</code></li> <li>Afficher un lorem ipsum <code>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus a dolor eleifend, efficitur elit sed, auctor sapien. Nulla lobortis augue sagittis viverra cursus. Fusce laoreet.</code></li></ul> <h3 id="resolution"><a href="#resolution" class="header-anchor">#</a> Résolution</h3> <ul><li>On crée notre projet (si ça n'est pas déjà fait), avec la commande <code>symfony new --full my_project</code></li> <li>On l'ouvre avec notre IDE et on lance le serveur Symfony (<code>symfony serve</code> dans un terminal)</li> <li>On crée notre controller (nous sommes dans un projet neuf, nous n'en avons pas), avec la commande <code>php bin/console make:controller</code>. Nommons-le <code>DefaultController</code></li> <li>Nous avons une nouvelle classe créée dans <code>src/Controller/DefaultController.php</code> et un nouveau template (une nouvelle vue) dans <code>template/default/index.html.twig</code></li> <li>Regardons <code>src/Controller/DefaultController.php</code> :</li></ul> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Bundle<span class="token punctuation">\</span>FrameworkBundle<span class="token punctuation">\</span>Controller<span class="token punctuation">\</span>AbstractController</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>Response</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Routing<span class="token punctuation">\</span>Annotation<span class="token punctuation">\</span>Route</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">DefaultController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractController</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * @Route(&quot;/&quot;, name=&quot;homepage&quot;)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'default/index.html.twig'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'controller_name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'DefaultController'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><ul><li>Il contient une classe <code>DefaultController</code> (qui étend <code>AbstractController</code>, venu de Symfony) et une méthode <code>index()</code> (c'est elle qui va particulièrement nous intéresser)</li> <li>Cette méthode <code>index()</code> a une annotation (commentaire commençant par <code>@</code>) nommée <code>Route</code>. Il s'agit d'une annotation permettant à Symfony de faire le lien entre une URi et une méthode de controller (aussi appelée action) à exécuter. Ici, <code>index()</code> sera appelée si nous chargeons la racine du site (<code>http://127.0.0.1:8000/</code>, en somme).</li> <li><code>index()</code> va faire une seule chose : renvoyer un html, construit à partir du fichier <code>default/index.html.twig</code> (qui se trouve dans le dossier <code>templates</code>). Pour se faire, on va appeler la méthode <code>render()</code> du controller, qui va créer un rendu de notre fichier Twig (en faire un html), en utilisant le tableau de paramètres, passé en deuxième argument.</li></ul> <p>Regardons maintenant notre fichier <code>templates/default/index.html.twig</code> (j'enlève le html présent, pour simplifier l'affichage) :</p> <div class="language-twig extra-class"><pre class="language-twig"><code><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">extends</span></span> <span class="token string"><span class="token punctuation">'</span>base.html.twig<span class="token punctuation">'</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span>

<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">block</span></span> <span class="token property">title</span> <span class="token rd"><span class="token punctuation">%}</span></span></span><span class="token other">Hello DefaultController!</span><span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endblock</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span>

<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">block</span></span> <span class="token property">body</span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
    <span class="token other"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello</span> <span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span> <span class="token property">controller_name</span> <span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other">! ✅<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span></span>
<span class="token tag"><span class="token ld"><span class="token punctuation">{%</span> <span class="token keyword">endblock</span></span> <span class="token rd"><span class="token punctuation">%}</span></span></span>
</code></pre></div><p>Plusieurs choses à voir ici aussi :</p> <ul><li>La syntaxe de Twig :
<ul><li>les tags <code>{% %}</code> : pour les divers mots clés du langage propre à Twig (conditions, extensions, blocs, etc.)</li> <li>les <code></code> (affectueusement appelées moustaches) : pour afficher une valeur (ici, le contenu d'une variable <code>controller_name</code>)</li></ul></li> <li>Ce fichier étend <code>templates/base.html.twig</code>, il en récupère donc les blocs et les étends. Il est impossible de mettre du texte en dehors d'un bloc, si vous étendez une vue.</li></ul> <p>Voilà, vous avez fait votre première page avec Symfony !</p> <h2 id="_2-exercice-apprivoiser-le-controller-et-la-vue"><a href="#_2-exercice-apprivoiser-le-controller-et-la-vue" class="header-anchor">#</a> 2. Exercice (apprivoiser le controller et la vue)</h2> <ul><li>On veut créer une nouvelle page (avec l'URi <code>/page</code>, dans le controller <code>DefaultController</code>)</li> <li>Dans la méthode du controller, déclarer une variable <code>$test</code> et l'initialiser à <code>false</code></li> <li>Créer un nouveau template <code>default/page.html.twig</code> qui va hériter de <code>base.html.twig</code></li> <li>Envoyer la variable <code>$test</code> dans la vue</li> <li>Utiliser la fonction <code>dump()</code> pour afficher toutes les variables disponibles dans la vue si <code>$test</code> vaut <code>true</code></li> <li>Vérifier en faisant varier <code>$test</code> dans la méthode du controller</li></ul> <h2 id="_3-exercice-apprivoiser-twig-et-sa-documentation"><a href="#_3-exercice-apprivoiser-twig-et-sa-documentation" class="header-anchor">#</a> 3. Exercice (apprivoiser Twig et sa documentation)</h2> <ul><li>Nous allons continuer à expérimenter dans le même projet Symfony</li> <li>Dans le <a href="/assets/exercice-integration.zip">fichier zip joint</a>, récupérer les fichiers et les insérer dans le dossier <code>public</code> de votre projet</li> <li>Créer une route (dans le controller de votre choix, vous pouvez en créer un nouveau pour vous entrainer) et une action (attention, bien définir une nouvelle URi, comme <code>/page/devbook</code>)</li> <li>Reprendre le contenu du fichier <code>index.html</code> et faire en sorte qu'il hérite de <code>base.html.twig</code> (utiliser les <code>block</code> définis dans ce fichier pour y ranger les js et css)</li> <li>Vérifier l'affichage</li> <li>Normalement, les images, css et javascripts ne devraient pas se charger correctement, il va falloir utiliser la <a href="https://symfony.com/doc/current/reference/twig_reference.html#asset" target="_blank" rel="noopener noreferrer">fonction asset() de Twig<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> pour les charger</li> <li>Vérifier régulièrement l'affichage et que tout se charge</li> <li>Une fois fait, découper votre fichier HTML en plusieurs fichiers (un fichier twig par section, par exemple, un fichier <code>hero-section.html.twig</code>) et inclure les différents fichiers à l'aide du <a href="https://twig.symfony.com/doc/3.x/tags/include.html" target="_blank" rel="noopener noreferrer">tag include de Twig<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Normalement, votre affichage doit être le même qu'au début, mais vous avez découpé le tout en plusieurs fichiers (plus faciles à maintenir)</li></ul> <h2 id="_4-manier-des-assets-les-controllers-et-twig"><a href="#_4-manier-des-assets-les-controllers-et-twig" class="header-anchor">#</a> 4. Manier des assets, les controllers et Twig</h2> <ul><li>Nous allons travailler sur votre Business Case</li> <li>Le but est de créer les pages demandées (nous allons commencer par les pages statiques et sans formulaire), avec leurs images, css et javascripts.</li></ul> <h2 id="_5-manier-doctrine-pour-utiliser-une-bdd"><a href="#_5-manier-doctrine-pour-utiliser-une-bdd" class="header-anchor">#</a> 5. Manier Doctrine pour utiliser une BdD</h2> <h3 id="_5-1-configuration-et-creation-de-la-base"><a href="#_5-1-configuration-et-creation-de-la-base" class="header-anchor">#</a> 5.1. Configuration et création de la base</h3> <ul><li>Dans notre projet de test (dans lequel nous avons fait les exercices 1, 2 et 3), nous allons ajouter des entités et synchroniser notre BdD</li> <li>Nous allons avoir besoin que Wamp/Mamp soit démarré pour avoir MySQL et PhpMyAdmin</li> <li>Configurer votre base de données et la créer avec la ligne de commande
<ul><li>Dans le fichier <code>.env</code>, mettre à jour le paramètre <code>DATABASE_URL</code> avec vos informations de connexion et le nom de votre BdD</li> <li>Créer la BdD avec la commande <code>php bin/console doctrine:database:create</code></li></ul></li></ul> <h3 id="_5-2-creation-d-entites-et-de-leurs-champs"><a href="#_5-2-creation-d-entites-et-de-leurs-champs" class="header-anchor">#</a> 5.2. Création d'entités et de leurs champs</h3> <ul><li><p>Créons deux entités, à l'aide de la commande <code>php bin/console make:entity</code> :</p> <ul><li><code>Composer</code> ayant 6 propriétés :
<ul><li><code>id</code> (entier, généré automatiquement)</li> <li><code>name</code> (string, longueur de 255, non null)</li> <li><code>description</code> (texte, non null)</li> <li><code>birth</code> (entier)</li> <li><code>death</code> (entier)</li> <li><code>birthCountry</code> (string, longueur de 128)</li></ul></li> <li><code>Music</code> ayant 4 propriétés :
<ul><li><code>id</code> (entier, généré automatiquement)</li> <li><code>name</code> (string, longueur de 255, non null)</li> <li><code>year</code> (entier)</li> <li><code>composer</code> (une relation avec <code>Composer</code> de type <code>ManyToOne</code>)</li></ul></li></ul></li> <li><p>Regardons les fichiers générés par notre commande. Les deux premiers sont nos entités (objet PHP simple, avec des annotations pour le lien avec la BdD). Les suivants sont nos repositories (ce sont eux qui vont nous permettre de faire des requêtes).</p> <ul><li><code>src/Entity/Composer.php</code></li> <li><code>src/Entity/Music.php</code></li> <li><code>src/Repository/ComposerRepository.php</code></li> <li><code>src/Repository/MusicRepository.php</code></li></ul></li></ul> <h3 id="_5-3-migration"><a href="#_5-3-migration" class="header-anchor">#</a> 5.3. Migration</h3> <ul><li>Créer et jouer la migration qui correspond
<ul><li><code>php bin/console doctrine:migrations:diff</code> pour créer la migration</li> <li>Vérifier le fichier de migration correspondant (son nom est affiché par la commande)</li> <li><code>php bin/console doctrine:migrations:migrate</code> pour la lancer</li> <li>Vérifier que les tables sont bien créées et que tous les champs sont bien présents</li></ul></li></ul> <h3 id="_5-4-utiliser-ces-entites-dans-les-controllers"><a href="#_5-4-utiliser-ces-entites-dans-les-controllers" class="header-anchor">#</a> 5.4. Utiliser ces entités dans les controllers</h3> <h4 id="_5-4-1-appeler-le-repository-pour-recuperer-tous-les-objets-composer"><a href="#_5-4-1-appeler-le-repository-pour-recuperer-tous-les-objets-composer" class="header-anchor">#</a> 5.4.1. Appeler le repository pour récupérer tous les objets Composer</h4> <ul><li>Créer une route pour le chemin <code>/composer</code> (et un nouveau controller) qui va :
<ul><li>Prendre en paramètre <code>ComposerRepository</code> (c'est-à-dire que votre action sera de cette forme <code>public function monAction(ComposerRepository $composerRepository)</code>)</li> <li>Récupérer la liste des compositeurs (<code>Composer</code>) à l'aide de <code>$composerRepository-&gt;findAll()</code></li> <li>Créer la vue correspondante (fichier Twig comme <code>templates/composer/index.html.twig</code>, par exemple) et utiliser la méthode <code>$this-&gt;render()</code> du controller pour renvoyer une <code>Response</code></li> <li>Dans la vue, afficher vos objets dans un tableau html (ils vous avaient manqué, j'en suis sûr)</li></ul></li></ul> <h4 id="_5-4-2-creer-des-objets-et-les-sauvegarder-en-base"><a href="#_5-4-2-creer-des-objets-et-les-sauvegarder-en-base" class="header-anchor">#</a> 5.4.2. Créer des objets et les sauvegarder en base</h4> <ul><li>Créer une route pour le chemin <code>/composer/new</code> (dans le même controller que précédemment) qui va :
<ul><li>Prendre en paramètre <code>EntityManagerInterface</code> (c'est-à-dire que votre action sera de cette forme <code>public function monAction(EntityManagerInterface $entityManager)</code>)</li> <li>Créer un ou des objets <code>Composer</code> (avec un <code>new Composer</code>)</li> <li>Les persister en base (méthodes <code>persist($object)</code> et <code>flush()</code> du service <code>EntityManagerInterface</code>)</li> <li>Rediriger vers la page de liste <code>/composer</code></li></ul></li></ul> <h4 id="_5-4-3-recuperer-un-objet-par-son-identifiant"><a href="#_5-4-3-recuperer-un-objet-par-son-identifiant" class="header-anchor">#</a> 5.4.3. Récupérer un objet par son identifiant</h4> <ul><li>Créer une route pour le chemin <code>/composer/{id}</code> (dans le même controller que précédemment) qui va :
<ul><li>Prendre en paramètre un objet <code>Composer</code> (c'est-à-dire que votre action sera de cette forme <code>public function monAction(Composer $composer)</code>)</li> <li>Créer un template qui va en afficher les différentes propriétés (y compris les différents objets <code>Music</code> associés, que vous pouvez récupérer avec <code>composer.musics</code> dans votre template)</li></ul></li></ul> <h4 id="_5-4-4-aller-un-peu-plus-loin-avec-l-objet-music"><a href="#_5-4-4-aller-un-peu-plus-loin-avec-l-objet-music" class="header-anchor">#</a> 5.4.4. Aller un peu plus loin avec l'objet Music</h4> <p>Pour tout ce qui a été fait jusqu'ici, il y a un <a href="https://www.loom.com/share/09a47cb371e24523ac05043d5fb54f53" target="_blank" rel="noopener noreferrer">corrigé vidéo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> si vous le souhaitez. Le corrigé de ce qui suit est <a href="https://www.loom.com/share/2b370106884f405da6335ae8975091c1" target="_blank" rel="noopener noreferrer">disponible dans cette vidéo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Nous allons faire de même avec les objets <code>Music</code></p> <ul><li><p>Créer une route pour le chemin <code>/music</code> (et un nouveau controller <code>MusicController</code>) qui va :</p> <ul><li>Prendre en paramètre <code>MusicRepository</code> (c'est-à-dire que votre action sera de cette forme <code>public function monAction(MusicRepository $musicRepository)</code>)</li> <li>Récupérer la liste des morceaux (<code>Music</code>) à l'aide de <code>$musicRepository-&gt;findAll()</code></li> <li>Créer la vue correspondante (fichier Twig comme <code>templates/music/index.html.twig</code>, par exemple) et utiliser la méthode <code>$this-&gt;render()</code> du controller pour renvoyer une <code>Response</code></li> <li>Dans la vue, afficher vos objets dans un tableau html (ils vous avaient manqué, j'en suis sûr)</li></ul></li> <li><p>Créer une route pour le chemin <code>/music/new</code> (dans le même controller que précédemment) qui va :</p> <ul><li>Prendre en paramètre <code>EntityManagerInterface</code> et <code>ComposerRepository</code> (c'est-à-dire que votre action sera de cette forme <code>public function monAction(EntityManagerInterface $entityManager, ComposerRepository $composerRepository)</code>)</li> <li>Créer un ou des objets <code>Music</code> (avec un <code>new Music</code>)</li> <li>Récupérer un ou des objets <code>Composer</code> et les associer à vos objets <code>Music</code> fraîchement créés
<ul><li>Pour cela, nous allons utiliser <code>$composerRepository-&gt;findBy(['name' =&gt; &quot;nom d'un compositeur que vous avez entré&quot;])</code> pour chercher un compositeur</li> <li><code>findBy</code> permet de faire une requête <code>SELECT</code> avec des <code>WHERE</code>, sans taper de SQL.</li></ul></li> <li>Les persister en base (méthodes <code>persist($object)</code> et <code>flush()</code> du service <code>EntityManagerInterface</code>)</li> <li>Rediriger vers la page de liste <code>/music</code></li></ul></li> <li><p>Créer une route pour le chemin <code>/music/{id}</code> (dans le même controller que précédemment) qui va :</p> <ul><li>Prendre en paramètre un objet <code>Music</code></li> <li>Créer un template qui va en afficher les différentes propriétés (y compris le nom du morceau, à l'aide de <code>music.composer.name</code>)</li></ul></li> <li><p>Compléter votre vue de l'exercice <code>5.4.3</code> pour récupérer les musiques associées (et/ou vérifier que tout fonctionne)</p></li></ul> <h2 id="_6-manier-le-querybuilder"><a href="#_6-manier-le-querybuilder" class="header-anchor">#</a> 6. Manier le QueryBuilder</h2> <p>Maintenant, nous allons écrire des requêtes, dans nos repositories, en utilisant le QueryBuilder de Doctrine.</p> <p>Pour chacune des requêtes demandées, les tester dans un controller, où vous avez préalablement injecté le repository.</p> <p>Dans <code>ComposerRespository</code>, écrire :</p> <ul><li>Une méthode <code>bornAfter(int $year)</code> qui prend en paramètre une année, et renvoie tous les compositeurs nés après l'année <code>$year</code></li> <li>Une méthode <code>bornBetween(int $start, int $end)</code> qui prend en paramètre deux années, une de début, une de fin, et renvoie tous les compositeurs nés après l'année <code>$start</code> et avant l'année <code>$end</code></li> <li>Une méthode <code>searchInName(string $name)</code> qui prend en paramètre un nom ou un morceau de nom, et renvoie tous les compositeurs dont le nom correspond à la recherche (utiliser <code>LIKE %recherche%</code>)</li></ul> <p>Dans <code>MusicRepository</code>, écrire :</p> <ul><li>Une méthode <code>searchInName(string $name)</code> sur le même principe que la précédente</li> <li>Une méthode <code>searchByComposerName(string $composerName)</code> qui prend en paramètre un nom ou un morceau de nom de compositeur et renvoie tous les morceaux correspondant.</li></ul> <p>Dans <code>ComposerRespository</code> de nouveau, écrire :</p> <ul><li>Une méthode <code>search(string $text)</code> qui prend en paramètre un nom ou un morceau de nom, et renvoie tous les compositeurs dont
<ul><li>le nom correspond à la recherche (utiliser <code>LIKE %recherche%</code>)</li> <li>ou le nom d'un morceau qu'il a composé correspond à la recherche</li></ul></li> <li>Tester ce repository dans un controller</li></ul> <h2 id="_7-projet-outil-de-montage-d-ordinateurs"><a href="#_7-projet-outil-de-montage-d-ordinateurs" class="header-anchor">#</a> 7. Projet : outil de montage d'ordinateurs</h2> <p>Un <a href="https://github.com/Dreeckan/symfony-computer" target="_blank" rel="noopener noreferrer">&quot;corrigé&quot; de l'exercice<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> est disponible sur Github. Pour les tickets créés, voir la <a href="https://github.com/Dreeckan/symfony-computer/issues?q=is%3Aissue" target="_blank" rel="noopener noreferrer">liste des issues<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Nous avons reçu ce cahier des charges :</p> <blockquote><p>Nous sommes une entreprise de vente d'ordinateurs prêt à l'emploi et personnalisés. Notre objectif est que tous nos clients puissent avoir un ordinateur qui leur correspond et réponde à leurs besoins de manière efficace.</p> <p>Pour répondre à cette demande, nos techniciens / monteurs souhaitent disposer d'un outil pour préparer les configurations à présenter à nos clients. Cet outil devra permettre de :</p> <ul><li>Créer des composants (CPU, RAM, carte graphique, boitier, alimentation, disque dur (ou SSD), carte mère, carte réseau), les modifier et les supprimer</li> <li>Créer des périphériques (Clavier, souris, écran, enceintes, webcam), les modifier et les supprimer</li> <li>Créer des ordinateurs, qui contiendront divers composants (un de chaque en général) et qui auront des périphériques associés (un de chaque également), les modifier et les supprimer</li></ul> <p>Cet outil sera installé en interne et nous n'aurons pour le moment pas besoin de nous connecter / gérer des utilisateurs</p> <p>Chaque élément aura un ensemble de caractéristiques (que nous verrons dans un deuxième cahier des charges), mais surtout un prix unitaire (en € HT). Notre programme devra calculer le prix des ordinateurs montés à partir du prix des pièces.</p></blockquote> <p>L'objectif est maintenant de découper cette demande pour pouvoir la traiter et se partager les tâches au sein de notre équipe. Pour cela il va falloir :</p> <ul><li>Faire le MCD (un exemple de ce qu'on a fait, <a href="/assets/mcd-computer.png">au format image</a>, ou <a href="/assets/mcd-computer.loo">le fichier Looping</a>)</li> <li>Déterminer les différentes fonctionnalités</li> <li>Créer le projet sur Github</li> <li>Inviter les différents participants</li> <li>Créer des tickets associés (Issues sur Github par exemple)
<ul><li>ces tickets doivent être cours à traiter (2 à 4h grand maximum)</li></ul></li> <li>Se les répartir entre les différents développeurs</li> <li>Avancer en parallèle (ou tous ensemble, les deux méthodes sont possibles)</li></ul> <h3 id="_7-1-premieres-ameliorations"><a href="#_7-1-premieres-ameliorations" class="header-anchor">#</a> 7.1. Premières améliorations</h3> <p>Notre client est content de nos avancées, et il a besoin de nouvelles fonctionnalités pour rendre son outil plus pratique. Voici ce qu'il a écrit :</p> <blockquote><p>Maintenant que nous pouvons travailler, il nous manque 2 choses</p> <ul><li>un menu pour naviguer entre les différentes pages (présent sur toutes les pages)</li> <li>Une page d'accueil pour voir les informations importantes :
<ul><li>Le nombre d'ordinateurs préparés (c'est-à-dire qui ont le bon nombre de périphériques et de composants)</li> <li>Le prix moyen des ordinateurs qui ont été préparés (c'est-à-dire qui ont le bon nombre de périphériques et de composants)</li> <li>Le prix total des composants en stock</li> <li>Le prix total des périphériques en stock</li></ul></li></ul></blockquote> <p>De nouveau, il faut :</p> <ul><li>Découper la demande en fonctionnalités</li> <li>Créer des tickets (issues)</li> <li>Les répartir</li> <li>Les coder (une fois fait, créer des PR et les faire relire par les autres membres du groupe)</li></ul> <p>Outils utiles :</p> <ul><li>Faire votre menu directement dans base.html.twig (utiliser KnpMenuBundle si vous êtes très courageux...)</li> <li><code>COUNT</code> et <code>SUM</code> peuvent être utilisées directement dans le <code>select()</code> du QueryBuilder</li> <li><code>-&gt;getQuery()-&gt;getSingleScalarResult()</code> vous permet de ne récupérer qu'un seul résultat (un nombre) avec des requêtes <code>SUM</code> / <code>COUNT</code></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/symfony/91-vote.html" class="prev">
        Projet : vote citoyen
      </a></span> <span class="next"><a href="/js/1-bases.html">
        Les bases du langage
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.a0283a3d.js" defer></script><script src="/assets/js/2.2bb1f65b.js" defer></script><script src="/assets/js/61.99515c03.js" defer></script>
  </body>
</html>
