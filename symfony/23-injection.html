<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Les services et l&#39;injection de dépendances</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Les formations de Rémi Jarjat pour Human Booster">
    
    <link rel="preload" href="/assets/css/0.styles.f78ef515.css" as="style"><link rel="preload" href="/assets/js/app.a0283a3d.js" as="script"><link rel="preload" href="/assets/js/2.2bb1f65b.js" as="script"><link rel="preload" href="/assets/js/47.112cd2f4.js" as="script"><link rel="prefetch" href="/assets/js/10.a27b6e9d.js"><link rel="prefetch" href="/assets/js/11.2193e9e3.js"><link rel="prefetch" href="/assets/js/12.f39a5b44.js"><link rel="prefetch" href="/assets/js/13.2d6a44aa.js"><link rel="prefetch" href="/assets/js/14.0673e9ad.js"><link rel="prefetch" href="/assets/js/15.a5eeeada.js"><link rel="prefetch" href="/assets/js/16.33dfc880.js"><link rel="prefetch" href="/assets/js/17.c79025e1.js"><link rel="prefetch" href="/assets/js/18.959ecd03.js"><link rel="prefetch" href="/assets/js/19.9b33ed18.js"><link rel="prefetch" href="/assets/js/20.ef228a5b.js"><link rel="prefetch" href="/assets/js/21.95b935c1.js"><link rel="prefetch" href="/assets/js/22.6089ec44.js"><link rel="prefetch" href="/assets/js/23.1786dcbd.js"><link rel="prefetch" href="/assets/js/24.1cc8c701.js"><link rel="prefetch" href="/assets/js/25.bfc350ad.js"><link rel="prefetch" href="/assets/js/26.bc869606.js"><link rel="prefetch" href="/assets/js/27.2974731f.js"><link rel="prefetch" href="/assets/js/28.c59ffda1.js"><link rel="prefetch" href="/assets/js/29.a4f4f78c.js"><link rel="prefetch" href="/assets/js/3.b306ebdc.js"><link rel="prefetch" href="/assets/js/30.f86e1c24.js"><link rel="prefetch" href="/assets/js/31.3a368f51.js"><link rel="prefetch" href="/assets/js/32.ae32716d.js"><link rel="prefetch" href="/assets/js/33.04577fe2.js"><link rel="prefetch" href="/assets/js/34.0036621d.js"><link rel="prefetch" href="/assets/js/35.ae9cca52.js"><link rel="prefetch" href="/assets/js/36.46328e65.js"><link rel="prefetch" href="/assets/js/37.b265ca29.js"><link rel="prefetch" href="/assets/js/38.30e09b09.js"><link rel="prefetch" href="/assets/js/39.b34ea9f8.js"><link rel="prefetch" href="/assets/js/4.1b3f0ff6.js"><link rel="prefetch" href="/assets/js/40.6ee002ae.js"><link rel="prefetch" href="/assets/js/41.fc420cf4.js"><link rel="prefetch" href="/assets/js/42.209ec249.js"><link rel="prefetch" href="/assets/js/43.2d7d1cd7.js"><link rel="prefetch" href="/assets/js/44.b9fd8430.js"><link rel="prefetch" href="/assets/js/45.15ab68bd.js"><link rel="prefetch" href="/assets/js/46.01b8ec0e.js"><link rel="prefetch" href="/assets/js/48.867e58b9.js"><link rel="prefetch" href="/assets/js/49.3ac37d3e.js"><link rel="prefetch" href="/assets/js/5.784f0707.js"><link rel="prefetch" href="/assets/js/50.f9dae8e2.js"><link rel="prefetch" href="/assets/js/51.43768ca2.js"><link rel="prefetch" href="/assets/js/52.dde625a3.js"><link rel="prefetch" href="/assets/js/53.72d8e143.js"><link rel="prefetch" href="/assets/js/54.bc802a1c.js"><link rel="prefetch" href="/assets/js/55.e1f55ab2.js"><link rel="prefetch" href="/assets/js/56.1118b442.js"><link rel="prefetch" href="/assets/js/57.c6e74a85.js"><link rel="prefetch" href="/assets/js/58.cfab71d0.js"><link rel="prefetch" href="/assets/js/59.6fb84388.js"><link rel="prefetch" href="/assets/js/6.a94e70e9.js"><link rel="prefetch" href="/assets/js/60.f130f013.js"><link rel="prefetch" href="/assets/js/61.99515c03.js"><link rel="prefetch" href="/assets/js/62.d3e48f49.js"><link rel="prefetch" href="/assets/js/7.8a7612b0.js"><link rel="prefetch" href="/assets/js/8.82725242.js"><link rel="prefetch" href="/assets/js/9.8e900de4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f78ef515.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/LogoHB.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Liste des cours</a></li><li><a href="/general/" class="sidebar-link">Culture numérique</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/git/" class="sidebar-heading clickable"><span>Git</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/linux/" class="sidebar-link">Linux</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/php/" class="sidebar-heading clickable"><span>PHP</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/symfony/" class="sidebar-heading clickable router-link-active open"><span>Symfony</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/symfony/01-installation.html" class="sidebar-link">Installer Symfony et son environnement de travail</a></li><li><a href="/symfony/10-structure.html" class="sidebar-link">Structure et utilisation d'un projet</a></li><li><a href="/symfony/20-routing.html" class="sidebar-link">Le routing</a></li><li><a href="/symfony/21-controllers.html" class="sidebar-link">Les controllers</a></li><li><a href="/symfony/22-twig.html" class="sidebar-link">Twig</a></li><li><a href="/symfony/23-injection.html" aria-current="page" class="active sidebar-link">Les services et l'injection de dépendances</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/symfony/23-injection.html#pour-resumer" class="sidebar-link">Pour résumer</a></li><li class="sidebar-sub-header"><a href="/symfony/23-injection.html#comprendre-l-injection-de-dependances" class="sidebar-link">Comprendre l'injection de dépendances</a></li></ul></li><li><a href="/symfony/24-doctrine.html" class="sidebar-link">Doctrine et la BdD</a></li><li><a href="/symfony/25-formulaires.html" class="sidebar-link">Formulaires</a></li><li><a href="/symfony/26-translation.html" class="sidebar-link">Les traductions</a></li><li><a href="/symfony/27-event-listeners.html" class="sidebar-link">Event listeners/subscribers</a></li><li><a href="/symfony/30-user.html" class="sidebar-link">Connexion et sécurisation</a></li><li><a href="/symfony/40-bundles.html" class="sidebar-link">Bundles</a></li><li><a href="/symfony/41-easy-admin.html" class="sidebar-link">Easy Admin Bundle</a></li><li><a href="/symfony/42-api-platform.html" class="sidebar-link">Api Platform</a></li><li><a href="/symfony/80-cheat-sheet.html" class="sidebar-link">Pense-bêtes</a></li><li><a href="/symfony/81-quotidien.html" class="sidebar-link">Symfony au quotidien</a></li><li><a href="/symfony/82-docker.html" class="sidebar-link">Travailler avec Docker</a></li><li><a href="/symfony/90-doggies.html" class="sidebar-link">Projet : annonces de SPA / éleveurs</a></li><li><a href="/symfony/91-vote.html" class="sidebar-link">Projet : vote citoyen</a></li><li><a href="/symfony/99-exercices.html" class="sidebar-link">Exercices</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/js/" class="sidebar-heading clickable"><span>Javascript</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/lamp/" class="sidebar-link">Serveur Lamp</a></li><li><a href="/deploy/" class="sidebar-link">Déploiement</a></li><li><a href="/docker/" class="sidebar-link">Docker</a></li><li><a href="/ci/" class="sidebar-link">Intégration continue</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="les-services-et-l-injection-de-dependances"><a href="#les-services-et-l-injection-de-dependances" class="header-anchor">#</a> Les services et l'injection de dépendances</h1> <p><a href="https://symfony.com/doc/current/service_container.html" target="_blank" rel="noopener noreferrer">La documentation spécifique aux services<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div style="position:relative;padding-bottom:56.25%;height:0;"><iframe src="https://www.loom.com/embed/58f0891c518540cfbb7966680bd79a1a" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen="allowfullscreen" style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe></div> <h2 id="pour-resumer"><a href="#pour-resumer" class="header-anchor">#</a> Pour résumer</h2> <ul><li>Un service est une classe, dont une instance est créé par Symfony au chargement (on ne fait jamais nous-même un <code>new</code> sur un service)</li> <li>Toutes les classes dans le dossier <code>src</code>, à part les entités (et quelques autres éléments) sont des services</li> <li>Un service est une fonctionnalité, qui peut être <strong>injectée</strong> dans le constructeur de <strong>n'importe quel autre service</strong> ou dans des actions de controller.</li></ul> <h2 id="comprendre-l-injection-de-dependances"><a href="#comprendre-l-injection-de-dependances" class="header-anchor">#</a> Comprendre l'injection de dépendances</h2> <p>Avec Symfony, tout est service. Un service est une fonctionnalité (peut être seulement une classe), comme l'affichage d'un template, l'envoie des emails, etc. Il en existe déjà de nombreux dans Symfony, déjà fournis (comme Twig, plusieurs éléments de Doctrine ou un Mailer).</p> <p>Dans les faits, l'exemple suivant <code>return $this-&gt;render('blog/index.html.twig', ['page' =&gt; 3]);</code> fait appel, en interne, au service Twig pour construire le HTML et le met dans un objet <code>Response</code>.</p> <p>Nous avons donc déjà utilisé un service !</p> <p>Dans les faits, une partie des services sont disponibles dans ce que l'on appelle le Container (ni plus ni moins un tableau d'objets utilisables).</p> <p>Dans les faits, la déclaration des services est faite dans le fichier <code>config/services.yaml</code>.</p> <p>Ce sont ces lignes qui se chargent du plus gros du travail :</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">services</span><span class="token punctuation">:</span>
    <span class="token comment"># La configuration de base sur Symfony</span>
    <span class="token key atrule">_defaults</span><span class="token punctuation">:</span>
        <span class="token key atrule">autowire</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># Injection de dépendance automatique (il suffit de déclarer dans le controller d'un service d'autres service dont on va avoir besoin pour effectivement les avoir dans ce premier service)</span>
        <span class="token key atrule">autoconfigure</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># Nous pouvons déclarer des services spéciaux, cette configuration assure qu'ils seront déclarés comme tels automatiquement</span>
        <span class="token key atrule">public</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># Par défaut, aucun de nos services ne sont publiques (c'est à dire que très peu de services sont disponibles directement depuis le controller) </span>
        
    <span class="token comment"># Ce que disent ces lignes : toutes les classes dans le dossier source sont définies comme des services.</span>
    <span class="token comment"># À l'exception du contenu des dossiers DependencyInjection, Entity, Migrations et Tests et du fichier Kernel.php, qui ne sont donc pas considérés comme des services</span>
    <span class="token key atrule">App\</span><span class="token punctuation">:</span>
        <span class="token key atrule">resource</span><span class="token punctuation">:</span> <span class="token string">'../src/*'</span>
        <span class="token key atrule">exclude</span><span class="token punctuation">:</span> <span class="token string">'../src/{DependencyInjection,Entity,Migrations,Tests,Kernel.php}'</span>
        
    <span class="token comment"># Ces lignes viennent modifier la configuration pour le dossier src/Controller. Elles associent le tag controller.service_arguments aux controllers, qui permet de leur donner un comportement spécifique (être liés à des routes par exemple)</span>
    <span class="token key atrule">App\Controller\</span><span class="token punctuation">:</span>
        <span class="token key atrule">resource</span><span class="token punctuation">:</span> <span class="token string">'../src/Controller'</span>
        <span class="token key atrule">tags</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'controller.service_arguments'</span><span class="token punctuation">]</span>
</code></pre></div><p>Ainsi, un service de génération de mail pourra être déclaré comme suit :</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// src/Service/MailGenerator.php</span>
<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Service</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Mailer<span class="token punctuation">\</span>MailerInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Mime<span class="token punctuation">\</span>Email</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">MailGenerator</span>
<span class="token punctuation">{</span>
    <span class="token comment">/** @var MailerInterface */</span>
    <span class="token keyword">private</span> <span class="token variable">$mailer</span><span class="token punctuation">;</span>

    <span class="token comment">// On demande un service qui implémente l'interface MailerInterface (voir la doc de Symfony pour la liste des services disponibles ;) )</span>
    <span class="token comment">// Le service correspondant est automatiquement injecté</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">MailerInterface</span> <span class="token variable">$mailer</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">mailer</span> <span class="token operator">=</span> <span class="token variable">$mailer</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">generateAndSend</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$message</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$emailDest</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'you@example.com'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$email</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Email</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'admin@example.com'</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token variable">$emailDest</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">subject</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Un message !'</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token variable">$message</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Nous pouvons utiliser notre service $mailer où bon nous chante, comme dans n'importe quel objet</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">mailer</span><span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token variable">$email</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ...</span>

        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Maintenant, imaginons que nous voulions ajouter un deuxième paramètre à notre constructeur, mais pas un service. Par exemple, l'adresse utilisée pour l'envoi, que nous voulons récupérer dans la configuration. Il faut alors modifier notre service et le déclarer <strong>manuellement</strong>.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// src/Service/MailGenerator.php</span>
<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Service</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Mailer<span class="token punctuation">\</span>MailerInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Mime<span class="token punctuation">\</span>Email</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">MailGenerator</span>
<span class="token punctuation">{</span>
    <span class="token comment">/** @var MailerInterface */</span>
    <span class="token keyword">private</span> <span class="token variable">$mailer</span><span class="token punctuation">;</span>

    <span class="token comment">/** @var string */</span>
    <span class="token keyword">private</span> <span class="token variable">$fromEmail</span><span class="token punctuation">;</span>

    <span class="token comment">// On demande un service qui implémente l'interface MailerInterface (voir la doc de Symfony pour la liste des services disponibles ;) )</span>
    <span class="token comment">// Le service correspondant est automatiquement injecté</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token class-name type-declaration">MailerInterface</span> <span class="token variable">$mailer</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$fromEmail</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">mailer</span> <span class="token operator">=</span> <span class="token variable">$mailer</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fromEmail</span> <span class="token operator">=</span> <span class="token variable">$fromEmail</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">generateAndSend</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$message</span><span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$emailDest</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'you@example.com'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">bool</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$email</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Email</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">fromEmail</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token variable">$emailDest</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">subject</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Un message !'</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token variable">$message</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Nous pouvons utiliser notre service $mailer où bon nous chante, comme dans n'importe quel objet</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">mailer</span><span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token variable">$email</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ...</span>

        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Pour déclarer manuellement notre service, tout en profitant (quand même) de l'autowiring, il suffit d'ajouter un paramètre pour tous nos services, ou de surcharger la déclaration de notre service. Les deux possibilités sont présentées ci-dessous, il suffit d'en choisir une.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">services</span><span class="token punctuation">:</span>
    <span class="token key atrule">_defaults</span><span class="token punctuation">:</span>
        <span class="token key atrule">autowire</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> 
        <span class="token key atrule">autoconfigure</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> 
        <span class="token key atrule">public</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  
        <span class="token key atrule">bind</span><span class="token punctuation">:</span> <span class="token comment"># Ici, nous pouvons directement associer TOUS les paramètres $fromEmail qui sont à injecter dans des services</span>
            <span class="token comment"># Dès qu'une variable $fromEmail est déclarée dans le constructeur d'un service (ou une action de contrôleur)</span>
            <span class="token comment"># on lui donnera une valeur</span>
            <span class="token key atrule">$fromEmail</span><span class="token punctuation">:</span> <span class="token string">'admin@example.com'</span>
    
    <span class="token comment"># ...</span>
    <span class="token comment"># Tout ce qui était avant est inchangé</span>
    <span class="token comment"># ...</span>
    
    <span class="token comment"># Ou nous pouvons surcharger la définition de notre service, pour modifier ses paramètres</span>
    <span class="token key atrule">App\Service\MailGenerator</span><span class="token punctuation">:</span> <span class="token comment"># L'identifiant de notre service est son FQCN (nom complet de la classe)</span>
        <span class="token key atrule">arguments</span><span class="token punctuation">:</span> <span class="token comment"># On modifie le comportement de l'injection en lui disant de modifier les arguments (du constructeur) du service</span>
            <span class="token key atrule">$fromEmail</span><span class="token punctuation">:</span> <span class="token string">'admin@example.com'</span> <span class="token comment"># on fait alors correspondre notre paramètre $fromEmail à une valeur</span>
</code></pre></div><p>Et voilà ! Notre service est configuré et prêt à l'emploi. Nous pouvons maintenant l'appeler dans un controller ou n'importe quel autre service (en utilisant là encore l'autowiring pour l'appeler) :</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// src/Controller/MailController.php</span>
<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Service<span class="token punctuation">\</span>MailGenerator</span><span class="token punctuation">;</span> <span class="token comment">// On va avoir besoin de cette classe et on va utiliser son nom court</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Bundle<span class="token punctuation">\</span>FrameworkBundle<span class="token punctuation">\</span>Controller<span class="token punctuation">\</span>AbstractController</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>HttpFoundation<span class="token punctuation">\</span>Response</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Routing<span class="token punctuation">\</span>Annotation<span class="token punctuation">\</span>Route</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">MailController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractController</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * @Route(&quot;/email/envoie&quot;, name=&quot;mail_send&quot;)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">sendMail</span><span class="token punctuation">(</span><span class="token class-name type-declaration">MailGenerator</span> <span class="token variable">$mailGenerator</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Response</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$mailGenerator</span><span class="token operator">-&gt;</span><span class="token function">generateAndSend</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Un message à caractère informatif !'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'toto@example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'mail/sendMail.html.twig'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>L'un des services que nous allons le plus souvent injecter dans les controllers et l'objet <code>Request</code> de Symfony, mais nous en parlerons dans la partie sur les formulaires.</p> <p>Pour résumer, dans les paramètres de notre action, nous pouvons récupérer :</p> <ul><li>les paramètres de notre route</li> <li>des services que nous injectons pour les utiliser dans l'action.</li></ul> <p>L'un des principaux objectifs de ce découpage en services est de réduire le controller à son minimum et ce pourquoi il est fait : être un chef d'orchestre entre la requête et le rendu final.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/symfony/22-twig.html" class="prev">
        Twig
      </a></span> <span class="next"><a href="/symfony/24-doctrine.html">
        Doctrine et la BdD
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.a0283a3d.js" defer></script><script src="/assets/js/2.2bb1f65b.js" defer></script><script src="/assets/js/47.112cd2f4.js" defer></script>
  </body>
</html>
